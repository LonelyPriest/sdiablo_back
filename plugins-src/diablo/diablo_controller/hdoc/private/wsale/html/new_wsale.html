<div class="row hidden-print"> 
  <div class="col-md-12">
    <div>
      <span class="fg-magenta"><strong>键盘操作：</strong></span>
      <span class="bg-orange">F2-现金</span>
      <span class="bg-cyan">F3-刷卡</span>
      <span class="bg-checked">回车-保存</span>
      <span class="bg-red">F6-下一单</span>
    </div>
    <div class="portlet box purple diablo-margin-bottom-5"
	 sale-shortcut
	 go="key_action">
      
      <div class="portlet-title">
	<div class="caption"><i class="glyphicon glyphicon-record"></i>
	  <span>销售开单</span>
	</div>
	<div class="actions">
	  <div class="btn-group">
	    <button type="button" class="btn red"
		    x-ng-click="back()">返回<i class="glyphicon glyphicon-circle-arrow-left"></i>
	    </button>
	    
	    <button class="btn btn-info purple-stripe"
		    x-ng-disabled="disable_draft()"
		    x-ng-click="list_draft()">草稿<i class="glyphicon glyphicon-send"></i>
	    </button>

	    <button x-ng-if="select.retailer.type_id===1"
		    class="btn green-meadow purple-stripe"
		    x-ng-disabled="disable_withdraw()"
		    x-ng-click="withdraw()">提现<i class="glyphicon glyphicon-yen"></i>
	    </button>

	    <button class="btn red-sunglo purple-stripe"
		    x-ng-click="ticket()">电子券<i class="glyphicon glyphicon-bookmark"></i>
	    </button>
	    
	    <button class="btn btn-success purple-stripe"
		    x-ng-disabled="disable_save()"
		    x-ng-click="save_wsale()">保存
	      <i class="glyphicon glyphicon-save"></i></button>
	    <button class="btn btn-danger purple-stripe"
		    x-ng-disabled="disable_refresh"
		    x-ng-click="refresh()">下一单
	      <i class="glyphicon glyphicon-plus"></i></button>
	  </div>
	</div>
	<div class="tools"></div>
      </div>

      <div class="portlet-body">
	<div class="table-toolbar">
	  
	  <div class="row diablo-form-group">
	    <div class="col-xs-3 col-md-3 ">
	      <div class="input-group">
		<span class="input-group-addon">
		  <i class="glyphicon glyphicon-star fg-red"></i>会员</span>
	  	<input class="form-control" type="text"
		       ng-edit
	  	       x-ng-model="select.retailer"
	  	       placeholder="请选择会员" 
	  	       typeahead-editable="false"
		       typeahead-wait-ms="300"
		       typeahead-loading="loading"
		       typeahead-on-select="on_select_retailer($item, $model, $label)"
		       uib-typeahead="s as s.name for s in match_retailer_phone($viewValue)"/>
		<span x-ng-show="loading">
	  	  <i class="icon-spinner icon-spin icon-2x form-control-feedback"></i>
		</span>
	      </div>
	    </div>

	    <div class="col-xs-3 col-md-3">
	      <div class="input-group">
		<span class="input-group-addon">
		  <i class="glyphicon glyphicon-map-marker fg-red"></i>店铺</span>
	  	<select class="form-control" type="text"
	  		x-ng-model="select.shop" 
			x-ng-change="change_shop()"
	  		x-ng-options="s as s.name for s in shops">
		</select>
	      </div>
	    </div>

	    <div class="col-xs-3 col-md-3">
	      <time-search time="select.datetime" oread="!right.master"></time-search>
	    </div>

	    <div class="col-xs-3 col-md-3 ">
	      <div class="input-group">
		<span class="input-group-addon">
		  <i class="glyphicon glyphicon-user fg-red"></i>店员</span>
	  	<select class="form-control" type="text"
	  		x-ng-model="select.employee"
			x-ng-change="change_employee()"
	  		x-ng-options="e as e.name for e in employees|filter:$viewValue">
		</select> 
	      </div>
	    </div> 
	  </div> <!--END row-->


	  <!--BEGIN row-->
	  <div class="row diablo-form-group">
	    <div class="col-xs-3 col-md-3 ">
	      <div class="input-group">
	    	<span class="input-group-addon">
	    	  <i class="glyphicon glyphicon-comment fg-red"></i>备注</span>
	    	<input class="form-control"
		       type="text"
		       placeholder="备注"
	    	       x-ng-model="select.comment"/>
	      </div>
	    </div>
	    
	    <div class="col-xs-3 col-md-3">
	      <div class="input-group">
	    	<span class="input-group-addon">
	    	  <i class="glyphicon glyphicon-yen fg-red"></i>应付</span>
	    	<input class="form-control" type="text" readonly
	    	       x-ng-model="select.should_pay"/>
	      </div>
	    </div>

	    <div class="col-xs-3 col-md-3"> 
	      <div class="input-group">
		<span class="input-group-addon">
		  <i class="glyphicon glyphicon-yen fg-red"></i>现金</span>
		<form name="select.form.cashForm">
		  <div ng-class="{'has-error':select.form.cashForm.$invalid
				 && !select.form.cashForm.$pristine}">
	  	    <input class="form-control"
			   type="number" step="0.01"
			   disable-key
			   focus-auto="focus_attr.cash" 
	  		   x-ng-model="select.cash"
			   x-ng-pattern="pattern.money"
			   placeholder="现金"
			   x-ng-enter="disable_save() || save_wsale()"/>
		  </div>
		</form>
	      </div>
	    </div>

	    <div class="col-xs-3 col-md-3"> 
	      <div class="input-group">
		<span class="input-group-addon">
		  <i class="glyphicon glyphicon-credit-card fg-red"></i>刷卡</span>
		<form name="select.form.cardForm">
		  <div ng-class="{'has-error':select.form.cardForm.$invalid
				 && !select.form.cardForm.$pristine}">
	  	    <input class="form-control"
			   type="number" step="0.01"
			   disable-key
			   focus-auto="focus_attr.card" 
			   x-ng-pattern="pattern.money"
	  		   x-ng-model="select.card"
			   placeholder="刷卡"
			   x-ng-enter="disable_save() || save_wsale()"/>
		  </div>
		</form>
	      </div> 
	    </div>

	    <!-- <div class="col-xs-3 col-md-3">  -->
	    <!--   <div class="input-group">  -->
	    <!-- 	<span class="input-group-addon"> -->
	    <!-- 	  <i class="glyphicon glyphicon-yen fg-red"></i>优惠卷</span> -->
	    <!-- 	<input class="form-control" type="text" readonly -->
	    <!-- 	       x-ng-model="select.ticket"/>  -->
	    <!--   </div> -->
	    <!-- </div> -->
	    
	  </div> 
	  
	  

	  <!--BEGIN row-->
	  <div class="row diablo-form-group">
	    <div class="col-sm-3 col-md-3 col-xs-3">
	      <div class="input-group">
		<span class="input-group-addon">
	    	  <i class="glyphicon glyphicon-map-marker fg-red"></i>总数</span>
		<input class="form-control" type="text" readonly
	    	       x-ng-model="select.abs_total"/>
	      </div>
	    </div>
	    
	    
	    <div class="col-sm-3 col-md-3 col-xs-3"> 
	      <div class="input-group"> 
		<span class="input-group-addon">
		  <i class="glyphicon glyphicon-yen fg-red"></i>实付</span>
		<input class="form-control" readonly
	  	       x-ng-model="select.has_pay"/>
	      </div>
	    </div>

	    <div class="col-sm-3 col-md-3 col-xs-3"> 
	      <div class="input-group"> 
		<span class="input-group-addon">
		  <i class="glyphicon glyphicon-yen fg-red"></i>找零</span>
		<input class="form-control" type="text" readonly
	  	       x-ng-model="select.charge" />
	      </div>
	    </div>

	    <div class="col-xs-3 col-md-3"> 
	      <div class="input-group">
		<span class="input-group-addon">
		  <i class="glyphicon glyphicon-qrcode fg-red"></i>微信</span>
		<form name="select.form.wForm">
		  <div ng-class="{'has-error':select.form.wForm.$invalid
				 && !select.form.wForm.$pristine}">
	  	    <input class="form-control"
			   type="number" step="0.01"
			   disable-key
			   focus-auto="focus_attr.wxin" 
			   x-ng-pattern="pattern.money"
	  		   x-ng-model="select.wxin"
			   placeholder="微信"
			   x-ng-enter="disable_save() || save_wsale()"/>
		  </div>
		</form>
	      </div> 
	    </div>
	  </div>
	  
	  

	  <!-- ticket -->
	  <div class="row diablo-form-group"> 
	    <div class="col-sm-3 col-md-3">
	      <div class="input-group">
		<span class="input-group-addon">
		  <i class="glyphicon glyphicon-copyright-mark fg-red"></i>积分</span>
		<input class="form-control" readonly
	  	       x-ng-model="select.retailer.score"/> 
	      </div>
	    </div>
	    
	    <div class="col-sm-3 col-md-3">
	      <div class="input-group">
		<span class="input-group-addon">
		  <i class="glyphicon glyphicon-barcode fg-red"></i>批次</span>
		<input class="form-control" readonly
		       placeholder="电子卷批次号，由系统自动生成"
	  	       x-ng-model="select.ticket_batch"/> 
	      </div>
	    </div>
	    
	    <div class="col-sm-3 col-md-3">
	      <div class="input-group">
		<span class="input-group-addon">
		  <i class="glyphicon glyphicon-yen fg-red"></i>金额</span>
		<input class="form-control" readonly
		       placeholder="电子卷金额，由系统自动生成"
	  	       x-ng-model="select.ticket_balance"/> 
	      </div>
	    </div>

	    <div class="col-sm-3 col-md-3 col-xs-3"> 
	      <div class="input-group"> 
		<span class="input-group-addon">
	    	  <i class="glyphicon glyphicon-ban-circle fg-red"></i>核销</span>
		<select class="form-control" type="text"
	  		x-ng-model="select.verificate" 
	  		x-ng-options="v for v in vpays">
		</select> 
	      </div>
	    </div>
	    
	  </div>

	  <div x-ng-if="select.retailer.type_id===1" class="row diablo-form-group"> 
	    <div class="col-sm-3 col-md-3">
	      <div class="input-group">
		<span class="input-group-addon">
		  <i class="glyphicon glyphicon-yen fg-red"></i>余额</span>
		<input class="form-control" readonly
	  	       x-ng-model="select.surplus"/> 
	      </div>
	    </div>
	    
	    <div class="col-sm-3 col-md-3">
	      <div class="input-group">
		<span class="input-group-addon">
		  <i class="glyphicon glyphicon-yen fg-red"></i>提现</span> 
		<input class="form-control"
		       type="number"
		       readonly
		       placeholder="提现"
		       x-ng-model="select.withdraw"/>
	      </div>
	    </div>

	    <div class="col-sm-6 col-md-6">
	      <div class="input-group">
		<span class="input-group-addon">
		  <i class="glyphicon glyphicon-yen fg-red"></i>结余</span>
		<input class="form-control"
		       type="number"
		       readonly
	               x-ng-model="select.left_balance"/>
	      </div>
	    </div> 
	  </div>
	  
	</div> 
      </div>
      
      <!--BEGN portlet body--> 
      <div class="portlet-body">
	<!--BEGIN panel-->
	<uib-tabset>
	  <uib-tab heading="{{wsale_mode[0].title}}"
		   active="wsale_mode[0].active">
	    <div class="panel panel-default">
	      
	      <div class="table-responsive">
		<!--EBGIN table supplier-->
		<table class="table table-bordered
			      table-striped table-hover
			      table-condensed table-advanced">
		  <thead>
		    <tr>
		      <th class="text-center">序号</th>
		      <th x-ng-if="setting.barcode_mode" class="text-center">条码</th>
		      <th class="text-center">货号</th>
		      <!-- <th class="text-center">品名</th> -->
		      <th x-ng-if="setting.check_sale" class="text-center">库存</th> 
		      <th class="text-center">吊牌价</th>
		      <th class="text-center">折扣</th> 
		      <th class="text-center">单价</th>
		      <th class="text-center">数量</th>
		      <th class="text-center">成交价</th>
		      <th class="text-center">折扣率</th> 
		      <th class="text-center">合计</th>
		      <!-- <th class="col-md-1 col-sm-1 col-xs-1">备注</th> -->
		      <th class="text-center">操作</th>
		    </tr>
		  </thead>
		  <tbody>
		    <tr class="text-center" x-ng-repeat="inv in inventories"> 
		      <td class="text-center vert-align">{{inv.order_id}}</td>
		      
		      <td x-ng-if="setting.barcode_mode" class="col-md-2 text-left vert-align">
	  		<span ng-if="!inv.$new">{{inv.full_bcode}}</span>
	  		<form name="inv.form.bcode" ng-if="inv.$new">
	  		  <div ng-class="{'has-error':inv.form.bcode.$invalid
	  				 && !inv.form.bcode.$pristine}">
	  		    <input class="form-control text-left"
	  			   type="text"
	  			   required
	  			   x-ng-model="inv.full_bcode"
	  			   focus-auto="focus_attr.barcode"
	  			   placeholder="条码"
	  			   barcode-scanner
	  			   scanner="barcode_scanner"/>
	  		  </div>
	  		</form>
	  	      </td>
	  
		      <td class="col-md-2 text-left vert-align">
			<span ng-if="!inv.$new">{{inv.style_number}}</span>
			<form name="inv.form.good" ng-if="inv.$new">
			  <div ng-class="{'has-error':inv.form.good.$invalid
					 && !inv.form.good.$pristine}">
			    <input class="form-control text-left"
				   type="text"
				   required
				   x-ng-model="inv.full_name"
				   focus-auto="focus_attr.style_number"
				   placeholder="货号"
				   typeahead-editable="false"
				   typeahead-on-select="on_select_good($item, $model, $label)"
				   typeahead-wait-ms="300"
				   typeahead-loading="loading"
				   uib-typeahead="g as g.name for
						  g in match_style_number($viewValue)"/>
			    <span x-ng-show="loading">
			      <i class="glyphicon glyphicon-refresh"></i>
			    </span>
			  </div>
			</form>
		      </td>

		      <!-- <td>{{inv.style_number}}</td> -->
		      <!-- <td class="vert-align">{{inv.brand}}</td> -->
		      <td x-ng-if="setting.check_sale" class="vert-align">
			{{inv.total}}
		      </td>
		      
		      <td class="col-md-1 vert-align">{{inv.tag_price}}</td>

		      <!--discount-->
		      <td x-ng-if="!right.m_discount" class="vert-align">
			{{inv.fdiscount}}
		      </td>
		      
		      <td x-ng-if="right.m_discount" class="col-md-1 vert-align">
			<div x-ng-if="!inv.$new && !inv.free_update">
			  {{inv.fdiscount}}
			</div>
			<form name="inv.form.fdiscount"
			      ng-if="inv.$new && inv.free_color_size
				     || !inv.$new && inv.free_update">
			  <div ng-class="{'has-error':
					 inv.form.fdiscount.$invalid
					 && !inv.form.fdiscount.$pristine}">
			    <input class="form-control"
				   type="number" step="0.1"
				   required
				   disable-key
				   x-ng-pattern="pattern.discount"
				   x-ng-model="inv.fdiscount" />
			  </div>
			</form>
		      </td>
		      
		      <td x-ng-if="!right.m_price" class="vert-align">
			<div x-ng-if="(inv.fprice===0 || inv.fprice)">
			  {{inv.fprice}}
			</div>
		      </td>
		      
		      <td x-ng-if="right.m_price"
			  class="col-md-1 vert-align">
			<div ng-if="!inv.$new && !inv.free_update">
			  <div x-ng-if="(inv.fprice===0 || inv.fprice)">
			    {{inv.fprice}}
			  </div>
			</div>
			<form name="inv.form.fprice"
			      ng-if="inv.$new && inv.free_color_size
				     || !inv.$new && inv.free_update">
			  <div ng-class="{'has-error':
					 inv.form.fprice.$invalid
					 && !inv.form.fprice.$pristine}">
			    <input class="form-control"
				   type="number" step="0.01"
				   required
				   disable-key
				   x-ng-pattern="/^\d+(.\d{1,2})?$/"
				   x-ng-model="inv.fprice"/>
			  </div>
			</form>
		      </td>
		      
		      <!-- <td class="vert-align">{{inv.total}}</td> -->

		      <!-- sell count-->
		      <td class="col-md-1 vert-align">
			<div x-ng-if="!inv.$new && !inv.free_update">{{inv.sell}}</div> 
			<form name="inv.form.sell"
			      x-ng-if="inv.$new && inv.free_color_size
				       || !inv.$new && inv.free_update">
			  <div ng-class="{'has-error':(inv.form.sell.$invalid
					 &&!inv.form.sell.$pristine) || inv.invalid_sell}">
			    <input type="number" step="1"
				   class="form-control"
				   placeholder="数量"
				   required
				   disable-key
				   x-ng-pattern="pattern.sell"
				   x-ng-model="inv.sell"
				   focus-auto="focus_attr.sell" 
				   x-ng-change="auto_save_free(inv)" />
			  </div> 
			</form>
		      </td>
		      
		      <td class="vert-align"><span class="fg-red">{{inv.rprice}}<span></td> 
		      <td class="vert-align"><span class="fg-red">{{inv.rdiscount}}</span></td> 
		      <td class="vert-align"><span>{{inv.calc}}</span></td>
		      
		      <!-- <td class="vert-align col-md-1"> -->
		      <!-- 	<form> -->
		      <!-- 	  <div>  -->
		      <!-- 	    <input class="form-control input-xs" -->
		      <!-- 		   type="text" -->
		      <!-- 		   placeholder="备注" -->
		      <!-- 		   x-ng-model="inv.comment"/> -->
		      <!-- 	  </div> -->
		      <!-- 	</form> -->
		      <!-- </td> -->
		      
		      <td class="text-left vert-align">
			<span x-ng-if="inv.$new"> 
			  <a class="btn diablo-input-button btn-success"
			     x-ng-if="!inv.free_color_size"
			     x-ng-disabled="inv.form.good.$invalid"
			     x-ng-click="add_inventory(inv)">新增
			    <i class="glyphicon glyphicon-plus"></i></a>
			  
			  <a class="btn diablo-input-button btn-warning"
			     x-ng-click="reset_inventory(inv)">重置
			    <i class="glyphicon glyphicon-pushpin"></i></a> 
			</span>

			<span ng-if="inv.$edit">
			  <a class="btn diablo-input-button btn-primary"
			     x-ng-if="!inv.free_update"
			     x-ng-disabled="inv.free_color_size"
			     x-ng-click="inventory_detail(inv)">详情
			    <i class="glyphicon glyphicon-eye-open"></i></a>
			  
			  <a class="btn diablo-input-button yellow"
			     x-ng-if="!inv.free_update"
			     x-ng-click="update_inventory(inv)">修改
			    <i class="glyphicon glyphicon-edit"></i></a>
			  
			  <a class="btn diablo-input-button btn-danger"
			     x-ng-if="!inv.free_update"
			     x-ng-click="delete_inventory(inv)">删除
			    <i class="glyphicon glyphicon-erase"></i></a>

			  <a class="btn diablo-input-button btn-success"
			     x-ng-show="inv.free_update"
			     x-ng-disabled="inv.form.good.$invalid
					    || inv.form.sell.$invalid
			    		    || inv.form.fprice.$invalid
			    		    || inv.form.fdiscount.$invalid"
			     x-ng-click="save_free_update(inv)">保存
			    <i class="glyphicon glyphicon-plus"></i></a>
			  
			  <a class="btn diablo-input-button btn-danger"
			     ng-if="inv.free_update"
			     x-ng-disabled=" inv.form.sell.$invalid"
			     x-ng-click="cancel_free_update(inv)">取消
			    <i class="glyphicon glyphicon-off"></i></a> 
			</span>
			
		      </td>
		    </tr>

		    <tr x-ng-if="inventories.length>1" class="text-center">
		      <td></td>
		      <td x-ng-if="setting.barcode_mode"></td>
		      <td></td>
		      <td x-ng-if="setting.check_sale"></td>
		      <td colspan=3></td>
		      <td class="vert-align">{{select.abs_total}}</td>
		      <td></td>
		      <td></td>
		      <!-- <td x-ng-if="!setting.show_discount" colspan=2></td> -->
		      <td class="vert-align">{{select.should_pay}}</td>
		      <td colspan="2"></td>
		      <!-- <td colspan="2">{{select.score}}</td> -->
		    </tr> 
		  </tbody>
		  <tfoot>
		  </tfoot>
		</table> <!--END supplier table-->
	      </div> <!--END table responsive--> 
	    </div> <!--END panel--> 
	  </uib-tab> 
	</uib-tabset>

	<div x-ng-if="select.score!==0">
	  <span class="fg-red">总积分：</span>
	  <span class="fg-color-darken">
	    <strong>{{select.score}}</strong>
	  </span>
	</div>
	<div x-ng-repeat="p in show_promotions">
	  <div>{{p.name}}&nbsp&nbsp&nbsp&nbsp
	    
	    <span class="bg-blue">促销：</span> 
	    <span x-ng-if="p.promotion">
	      <span x-ng-switch on="p.promotion.rule_id">
	      	<span x-ng-switch-when=0>
	      	  <span class="fg-red">{{p.promotion.discount}}</span>折
	      	</span>
		
	      	<span x-ng-switch-when=1>
	      	  满<span class="fg-red">{{p.promotion.cmoney}}</span>
	      	  送<span class="fg-red">{{p.promotion.rmoney}}</span>
	      	</span>
	      </span>
	    </span>
	    <span x-ng-if="!p.promotion">无</span>

	    &nbsp&nbsp&nbsp&nbsp<span class="bg-blue">积分：</span>
	    <span x-ng-if="p.score">
	      <span class="fg-red">{{p.score.name}}</span>
	    </span>
	    <span x-ng-if="!p.score">无</span> 
	  </div> 
	</div>
	    
      </div> <!--END portlet body--> 
      
    </div> <!--END portlet box-->
  </div> <!--END col-md-12-->
</div> <!--END row-->

<!--print-->
<!-- <div class="row visible-print-block"> -->
<!--   <div class="text-center"><strong>{{select.shop.name}}</strong></div> -->
<!--   <div class="text-left"> -->
<!--     <p> -->
<!--       <div>单号：<span x-ng-bind="select.rsn"></span></div> -->
<!--       <div>客户：<span x-ng-bind="select.retailer.name"></span> -->
<!-- 	<span>店员：<span x-ng-bind="select.employee.name"></span><span></div> -->
<!--       <div> -->
<!-- 	日期：{{select.datetime|date: "yyyy-MM-dd HH:mm:ss"}} -->
<!--       </div> -->
<!--       <div><span>================================</span></div>  -->
<!--     </p> -->
<!--   </div>  -->
<!--   <div x-ng-repeat="inv in inventories"> -->
<!--     <div x-ng-if="!inv.$new"> -->
<!--       <div>款号：<span>{{inv.style_number}}</span></div> -->
<!--       <div>品名：<span>{{inv.brand}}</span></div> -->
<!--       <div>单价：<span>{{inv.tag_price}}</span></div> -->
<!--       <div>成交价：<span>{{inv.rprice}}</span></div> -->
<!--       <div>数量：<span>{{inv.sell}}</span></div> -->
<!--       <div>小计:<span>{{inv.calc}}</span></div> -->
<!--       <div>折扣率： <span>{{f_discount(inv.rprice, inv.tag_price)}}</span></div> -->
<!--       <div>--------------------------------</div> -->
<!--     </div> -->
<!--   </div>  -->

<!--   <div>总计：{{select.total}}</div> -->
<!--   <div>实付：{{select.should_pay}}</div> -->
<!--   <div x-ng-if="select.retailer.id !== setting.no_vip"> -->
<!--     <div>上次积分：<span>{{select.retailer.score}}</span></div> -->
<!--     <div>本次积分：<span>{{select.score}}</span></div> -->
<!--     <div>累计积分：<span>{{select.retailer.score + select.score}}</span></div> -->
<!--     <div>--------------------------------</div> -->
<!--   </div> -->

<!--   <div>顾客需知：</div> -->
<!--   <div x-ng-repeat="c in comments"> -->
<!--     <div>{{c.id}}：{{c.name}}</div> -->
<!--   </div> -->
<!--   <div>打印日期：{{select.datetime|date: 'yyyy-MM-dd HH:mm'}}</div> -->
<!-- </div> -->


<script type="text/ng-template" id="wsale-new.html">
  <div class="modal-body"> 
    <div class="diablo-form-group">
      <div class="input-group">
	
	<span class="input-group-addon">
	  <i class="glyphicon glyphicon-yen fg-red"></i>
	</span>

	<div x-ng-if="!params.right.m_price">
	  <input class="form-control text-center"
		 readonly
		 x-ng-model="params.fprice" />
	</div>
	<div x-ng-if="params.right.m_price">
	  <form name="fprice">
	    <div ng-class="{'has-error':fprice.$invalid && !fprice.$pristine}">
	      <input class="form-control text-center"
		     type="number" step="0.01"
		     required
		     disable-key 
		     x-ng-model="params.fprice"
		     placeholder="支持两位小数"
		     x-ng-pattern="/^\d+(.\d{1,2})?$/"/>
	    </div>
	  </form>
	</div>
	
	<span class="input-group-addon">
	  <i class="glyphicon glyphicon-sort-by-attributes-alt fg-red"></i>
	</span>
	
	<div x-ng-if="!params.right.m_discount">
	  <input class="form-control text-center"
		 type="number" step="0.01"
		 readonly
		 x-ng-model="params.fdiscount"/>
	</div>
	
	<div x-ng-if="params.right.m_discount">
	  <form name="fdiscount">
	    <div ng-class="{'has-error':fdiscount.$invalid && !fdiscount.$pristine}">
	      <input class="form-control text-center"
		     type="number" step="0.01"
		     required
		     disable-key
		     x-ng-pattern="/^\d{1,2}(\.\d{1,2})?$|100$/"
		     x-ng-model="params.fdiscount"
		     placeholder="dd.dd" />
	    </div>
	  </form>
	</div>
      </div>
    </div>

    
    <div class="table-responsive">
      <table class="table table-bordered
		    table-striped table-condensed table-advanced" navtable>
	<tbody>
	  <tr>
	    <td></td>
	    <td x-ng-repeat="s in params.sizes" x-ng-switch on="s">
	      <span x-ng-switch-when="0">均码</span>
	      <span x-ng-switch-default>{{s}}</span>
	    </td>
	  </tr>
	  <tr x-ng-repeat="c in params.colors">
	    <td x-ng-show="params.large_size" x-ng-switch on="c.cid">
	      <span x-ng-switch-when="0">均色</span>
	      <span x-ng-switch-default>{{c.cname}}</span>
	    </td>

	    <td x-ng-show="!params.large_size"
		class="col-md-1"
		x-ng-switch on="c.cid">
	      <span x-ng-switch-when="0">均色</span>
	      <span x-ng-switch-default>{{c.cname}}</span>
	    </td>

	    <td x-ng-repeat="s in params.sizes">
	      <div x-ng-if="(amount=params.get_amount(c.cid, s, params.amounts))?true:false">
		
		<div class="input-group">
		  <span class="input-group-addon modal-input-group-addon">
		    {{amount.count}}
		  </span>
		  <form name="aform">
		    <div ng-class="{'has-error':aform.$invalid || !params.valid_sell(amount)}">
		      <input x-ng-if="amount"
			     class="form-control modal-input text-center"
			     type="number" step="1"
			     disable-key
			     x-ng-enter="!fprice.$invalid
					 && !fdiscount.$invalid
					 && params.valid(params.amounts) && ok()"
			     x-ng-model="amount.sell_count"
			     focus-auto="amount.focus" />
		    </div>
		  </form>
		</div>
		
	      </div> 
	    </td> 
	  </tr>
	</tbody> 
      </table>
    </div> <!--END table-responsive-->
    <image x-ng-show="params.path"
    	   class="img-responsive img-thumbnail"
    	   ng-src="{{params.path}}"></image>
  </div>

  <div class="modal-footer">
    <button class="btn btn-primary"
	    x-ng-disabled="fprice.$invalid
			   || fdiscount.$invalid
			   || !params.valid(params.amounts)"
	    x-ng-click="ok()">保存
    </button>
    <button class="btn btn-warning" x-ng-click="cancel()">取消</button>
  </div>
</script>

<script type="text/ng-template" id="wsale-detail.html">
  <div class="modal-body">

    <div class="diablo-form-group">
      <div class="input-group">
	
	<span class="input-group-addon">
	  <i class="glyphicon glyphicon-yen fg-red"></i>
	</span> 
	<input class="form-control text-center"
	       readonly
	       x-ng-model="params.fprice" />
	
	<span class="input-group-addon">
	  <i class="glyphicon glyphicon-sort-by-attributes-alt fg-red"></i>
	</span> 
	<input class="form-control text-center"
	       readonly
	       x-ng-model="params.fdiscount" /> 
      </div>
    </div>
    
    <div class="table-responsive">
      <table class="table table-bordered
		    table-striped table-condensed table-advanced">
	<tbody>
	  <tr>
	    <td></td>
	    <td x-ng-repeat="s in params.sizes" x-ng-switch on="s">
	      <span x-ng-switch-when="0">均码</span>
	      <span x-ng-switch-default>{{s}}</span>
	    </td>
	  </tr>
	  <tr x-ng-repeat="c in params.colors">
	    <td class="col-md-1" x-ng-switch on="c.cid">
	      <span x-ng-switch-when="0">均色</span>
	      <span x-ng-switch-default>{{c.cname}}</span>
	    </td>
	    <!-- <td class="col-md-1">{{c.cname}}</td> -->
	    <td x-ng-repeat="s in params.sizes">
	      {{params.get_amount(c.cid, s, params.amounts).sell_count}} 
	    </td>
	  </tr>
	</tbody>
      </table>
    </div> <!--END table-responsive-->
    <image x-ng-show="params.path"
    	   class="img-responsive img-thumbnail"
    	   ng-src="{{params.path}}"></image>
  </div>

  <div class="modal-footer">
    <button class="btn btn-primary" x-ng-click="ok()">确定</button>
    <!-- <button class="btn btn-warning" x-ng-click="cancel()">取消</button> -->
  </div>
</script>

<script type="text/ng-template" id="new-withdraw.html">
  <div class="modal-header">
    <button class="close" x-ng-click="cancel()" type="button">
      <span aria-hidden="true">&times;</span>
      <span class="sr-only"></span>
    </button>
    
    <h4 class="modal-title"><span class="label label-sm label-primary">
	会员提现</span></h4>
  </div>
  
  <div class="modal-body">
    <form class="form-horizontal" name="withdrawForm" novalidate>
      <div class="form-body">
	
	<div class="form-group">
	  <label class="col-sm-3 col-md-3 control-label">姓名</label>
	  <div class="col-sm-6 col-md-6">
	    <input class="form-control"
		   type="text"
		   x-ng-readonly="true"
		   x-ng-model="params.retailer.name"/> 
	  </div>
	</div>

	<div class="form-group">
	  <label class="col-sm-3 col-md-3 control-label">余额</label>
	  <div class="col-sm-6 col-md-6">
	    <input class="form-control"
		   type="number"
		   readonly
		   x-ng-model="params.retailer.surplus"/> 
	  </div>
	</div>
	
	<div class="form-group">
	  <label class="col-sm-3 col-md-3 control-label">提现金额</label>
	  
	  <div class="col-sm-6 col-md-6"> 
	      <input class="form-control"
		     type="number" step="1"
		     required
		     disable-key 
		     name="balance"
		     x-ng-pattern="/^\d+(.\d{1,2})?$/"
		     x-ng-model="params.retailer.withdraw"/>
	    <div ng-show="withdrawForm.balance.$invalid && !withdrawForm.balance.$pristine">
	      <span class="fg-red">金额只能是数字串</span>
	    </div>
	    <div ng-show="!params.check_withdraw(params.retailer.withdraw)">
	      <span class="fg-red">余额不足或提现金额超过上限</span> 
	    </div>
	  </div> 
	</div>

	<div class="form-group">
	  <label class="col-sm-3 col-md-3 control-label">密码</label>
	  <div class="col-sm-6 col-md-6">
	    <input class="form-control"
		   required
		   type="password"
		   name="withdraw"
		   x-ng-model="params.retailer.password"/> 
	  </div>
	</div>
	
      </div>
  </div>

  <div class="modal-footer">
    <button class="btn btn-primary"
	    x-ng-disabled="withdrawForm.$invalid
			   || !params.check_withdraw(params.retailer.withdraw)"
	    x-ng-click="ok()">确定</button>
    <button class="btn btn-warning" x-ng-click="cancel()">取消</button>
  </div> 
</script>

<script type="text/ng-template" id="wsale-draft.html">
  <div class="modal-body">
    <div class="table-responsive">
      <table class="table table-bordered
		    table-striped table-condensed table-advanced">
	<thead>
	  <tr>
	    <th></th>
	    <th>单号</th>
	    <th>会员</th>
	    <!-- <th>店员</th> -->
	    <th>店铺</th>
	  </tr>
	</thead>
	<tbody>
	  <tr x-ng-repeat="d in params.drafts">
	    <td class="vert-align">
	      <div class="checkbox checkbox-danger checkbox-circle">
		<input id={{d.sn}} type="checkbox" x-ng-model="d.select"/>
		<label for={{d.sn}}></label>
	      </div>
	    </td>
	    <td>{{d.sn}}</td>
	    <td>{{d.retailer.name}}</td>
	    <!-- <td>{{d.employee.name}}</td> -->
	    <td>{{d.shop.name}}</td>
	    <!-- <td>{{d.datetime}}</td>  -->
	  </tr>
	</tbody>
      </table>
    </div>
  </div>

  <div class="modal-footer">
    <button class="btn btn-primary"
	    x-ng-disabled="!params.valid(params.drafts)"
	    x-ng-click="ok()">确定</button>
    <button class="btn btn-warning" x-ng-click="cancel()">取消</button>
  </div>
</script>


<script type="text/ng-template" id="new-ticket.html">
  <div class="modal-header">
    <button class="close" x-ng-click="cancel()" type="button">
      <span aria-hidden="true">&times;</span>
      <span class="sr-only"></span>
    </button>
    
    <h4 class="modal-title"><span class="label label-sm label-primary">电子卷信息</span></h4>
  </div>
  
  <div class="modal-body">
    <form class="form-horizontal" name="tForm" novalidate>
      <div class="form-body">
	
	<div x-ng-if="params.auto_batch" class="form-group">
	  <label class="col-sm-3 col-md-3 control-label">批次号</label> 
	  <div class="col-sm-6 col-md-6">
	    <input class="form-control"
		   name="ticket"
		   type="number"
		   step="1"
		   readonly
		   required
		   x-ng-model="params.ticket.batch"/> 
	  </div>
	</div>

	<div x-ng-if="!params.auto_batch" class="form-group">
	  <label class="col-sm-3 col-md-3 control-label">批次号</label> 
	  <div class="col-sm-6 col-md-6">
	    <!-- <div class="input-group"> -->
	    <input class="form-control"
		   name="ticket"
		   type="number"
		   step="1"
		   placeholder="请输入电子卷批次号"
		   x-ng-edit
		   disable-key
		   disable-wheel
		   required
		   x-ng-model="params.ticket.batch"/>
	      <!-- <span class="input-group-btn"> -->
	      <!-- 	<button class="btn green" -->
	      <!-- 		x-ng-click="params.ticket=params.get_ticket(params.ticket.batch)"> -->
	      <!-- 	    <i class="glyphicon glyphicon-search"></i> -->
	      <!-- 	  </button> -->
	      <!-- </span> -->
	    <!-- </div> -->
	  </div>
	</div>

	<div x-ng-if="params.auto_batch" class="form-group">
	  <label class="col-sm-3 col-md-3 control-label">金额</label>
	  <div class="col-sm-6 col-md-6">
	    <input class="form-control"
		   type="number"
		   readonly
		   x-ng-model="params.ticket.balance"/> 
	  </div>
	</div> 
	
      </div>
  </div>

  <div class="modal-footer">
    <button class="btn btn-primary"
	    x-ng-disabled="tForm.$invalid"
	    x-ng-click="ok()">确定</button>
    <button class="btn btn-warning" x-ng-click="cancel()">取消</button>
  </div> 
</script>


