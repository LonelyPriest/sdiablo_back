<div class="row hidden-print"> 
  <div class="col-md-8"> 
    <div class="portlet box purple diablo-margin-bottom-5">
      
      <div class="portlet-title">
	<div class="caption"><i class="glyphicon glyphicon-record"></i>
	  <span>开单</span>
	  <span>{{select.datetime|date: 'yyyy-MM-dd'}}/{{select.lunar.Animal}}年{{select.lunar.IMonthCn}}{{select.lunar.IDayCn}}</span>
	</div>
	<div class="actions">
	  <div class="btn-group">
	    <button type="button" class="btn red"
		    x-ng-click="back()">返回<i class="glyphicon glyphicon-circle-arrow-left"></i>
	    </button>
	    
	    <button class="btn btn-info purple-stripe"
		    x-ng-disabled="disable_draft()"
		    x-ng-click="list_draft()">取单<i class="glyphicon glyphicon-send"></i>
	    </button>

	    <button class="btn btn-danger purple-stripe"
		    x-ng-disabled="disable_refresh"
		    x-ng-click="hang_draft()">挂单
	      <i class="glyphicon glyphicon-plus"></i></button> 
	  </div>
	</div>
	<div class="tools"></div>
      </div>

      <div class="portlet-body">
	<div class="table-toolbar">
	  <div class="row diablo-form-group">
	    <div class="col-xs-12 col-md-12">
	      <div class="input-group">
		<span class="input-group-addon">
	  	  <i class="glyphicon glyphicon-map-marker fg-red"></i>店铺</span>
	  	<select class="form-control" type="text"
	  		x-ng-model="select.shop"
	  		x-ng-change="change_shop()"
	  		x-ng-options="s as s.name for s in shops">
	  	</select>

		<span x-ng-if="setting.barcode_mode" class="input-group-addon">
		  <i class="glyphicon glyphicon-barcode fg-red"></i>条码</span>
		<form x-ng-if="setting.barcode_mode" name="bform">
		  <div ng-class="{'has-error':bform.barcode.$invalid && !bform.barcode.$pristine}">
		    <input id="barcode" class="form-control text-left"
			   type="text"
			   name="barcode"
			   x-ng-plus="auto_focus('cash')"
			   x-ng-model="sale.barcode"
			   placeholder="条码"
			   focus-auto="focus_attr.barcode"
			   x-ng-pattern="pattern.barcode"
			   barcode-scanner
			   scanner="barcode_scanner"/>
		  </div>
		</form>

		<span x-ng-if="right.master || !setting.scan_only" class="input-group-addon">
		  <i class="glyphicon glyphicon-signal fg-red"></i>货号</span>
		<form x-ng-if="right.master || !setting.scan_only" name="sform">
		  <div ng-class="{'has-error':sform.snumber.$invalid && !sform.snumber.$pristine}">
		    <input id="snumber" class="form-control text-left"
			   name="snumber"
			   type="text"
			   x-ng-plus="auto_focus('cash')"
			   x-ng-model="sale.style_number"
			   focus-auto="focus_attr.style_number"
			   placeholder="货号/品类"
			   typeahead-editable="false"
			   typeahead-on-select="on_select_good($item, $model, $label)"
			   typeahead-wait-ms="300"
			   typeahead-loading="loading"
			   uib-typeahead="g as g.name for g in match_style_number($viewValue)" />
		    <span x-ng-show="loading">
		      <i class="icon-spinner icon-spin icon-2x form-control-feedback"></i>
		    </span>
		  </div>
		</form>
		
	      </div>
	    </div> 
	  </div>
	</div> 
      </div>
      
      <!--BEGN portlet body--> 
      <div class="portlet-body"> 
	<div class="panel panel-default"> 
	  <div class="table-responsive">
	    <!--EBGIN table supplier-->
	    <table navtable class="table table-bordered table-striped table-hover
				   table-condensed table-advanced">
	      <thead>
		<tr>
		  <th x-ng-if="setting.negative_sale" class="text-center">选择</th>
		  <th class="text-center">序号</th>
		  <th class="text-center">
		    <span x-ng-if="setting.barcode_mode">条码/货号/品类</span>
		    <span x-ng-if="!setting.barcode_mode">货号/品类</span>
		  </th>
		  <th class="text-center">库存</th> 
		  <th class="text-center">吊牌价</th>
		  <th class="text-center">折扣</th> 
		  <th class="text-center">单价</th>
		  <th class="text-center">数量</th>
		  <!-- <th class="text-center">成交价</th> -->
		  <!-- <th class="text-center">折扣率</th>  -->
		  <th class="text-center">合计</th>
		  <th x-ng-if="setting.fixed_mode===1
			       && select.retailer.type_id===1
			       && select.retailer.balance!==0" class="text-center">提现</th>
		  <th class="text-center">色/码</th>
		  <th class="text-center">操作</th>
		</tr>
	      </thead>
	      <tbody>
		<tr class="text-center" x-ng-repeat="inv in inventories">
		  <td x-ng-if="setting.negative_sale">
		    <div x-ng-if="inv.bargin_price===3 && !setting.charge_with_special
				  || !inv.sell || inv.sell<=0"></div> 
		    <div x-ng-if="(inv.bargin_price!==3 || setting.charge_with_special) && inv.sell > 0">
		      <div class="checkbox checkbox-danger checkbox-circle">
			<input id={{inv.order_id}}
			       type="checkbox"
			       x-ng-model="inv.charge"/>
			<label for={{inv.order_id}}></label>
		      </div>
		    </div>
		  </td> 
		  
		  <td class="text-center vert-align">{{inv.order_id}}</td> 
		  <td class="text-left vert-align col-md-2">
		    <div class={{color_negative_sale(inv.negative)}}>
		      <span x-ng-if="setting.barcode_mode">
			{{inv.bcode}}/{{inv.full_name}}
		      </span>
		      <span x-ng-if="!setting.barcode_mode">
			{{inv.full_name}}
		      </span>
		    </div>
	  	  </td>
		  
		  <!-- <td class="col-md-2 text-left vert-align"> -->
		  <!--   <span class={{color_negative_sale(inv.negative)}}>{{inv.full_name}}</span> -->
		  <!-- </td>  -->
		  
		  <td class="vert-align">
		    <span class={{color_negative_sale(inv.negative)}}>{{inv.total}}</span>
		  </td> 
		  <td class="col-md-1 vert-align">
		    <div>
		      <span x-ng-if="inv.vir_price>inv.tag_price" x-ng-bind="inv.vir_price"></span>
		      <span x-ng-if="inv.vir_price<=inv.tag_price" x-ng-bind="inv.tag_price"></span>
		    </div>
		  </td>

		  <!--discount-->
		  <td x-ng-if="!right.m_discount" class="vert-align">
		    <span>{{inv.fdiscount}}</span>
		  </td>
		  
		  <td x-ng-if="right.m_discount" class="col-md-1 vert-align">
		    <div x-ng-if="!inv.free_update">{{inv.fdiscount}}</div>
		    <form name="inv.form.fdiscount" x-ng-if="!inv.$new && inv.free_update">
		      <div ng-class="{'has-error': inv.form.fdiscount.$invalid && !inv.form.fdiscount.$pristine}">
			<input class="form-control"
			       type="number" step="0.1"
			       required
			       disable-key
			       x-ng-edit
			       x-ng-enter="inv.form.fdiscount.$invalid || auto_save_free(inv)"
			       x-ng-pattern="pattern.discount"
			       x-ng-model="inv.fdiscount" />
		      </div>
		    </form>
		  </td>
		  
		  <td x-ng-if="!right.m_price" class="vert-align">
		    <div x-ng-if="(inv.fprice===0 || inv.fprice)">{{inv.fprice}}</div>
		  </td>
		  
		  <td x-ng-if="right.m_price" class="col-md-1 vert-align">
		    <div x-ng-if="!inv.free_update">
		      <div x-ng-if="(inv.fprice===0 || inv.fprice)">{{inv.fprice}}</div>
		    </div>
		    <form name="inv.form.fprice" x-ng-if="!inv.$new && inv.free_update">
		      <div ng-class="{'has-error': inv.form.fprice.$invalid && !inv.form.fprice.$pristine}">
			<input class="form-control"
			       type="number" step="0.01"
			       required
			       disable-key
			       x-ng-edit
			       focus-auto="focus_attr.sell"
			       x-ng-enter="inv.form.fprice.$invalid || auto_save_free(inv)"
			       x-ng-pattern="/^\d+(.\d{1,2})?$/"
			       x-ng-model="inv.fprice"/>
		      </div>
		    </form>
		  </td>
		  
		  <!-- <td class="vert-align">{{inv.total}}</td> -->

		  <!-- sell count-->
		  <td class="vert-align col-md-1">
		    <div x-ng-if="!inv.free_update">
		      <span x-ng-bind="inv.sell"></span> 
		    </div>
		    <form name="inv.form.sell" x-ng-if="!inv.$new && inv.free_update">
		      <div ng-class="{'has-error':(inv.form.sell.$invalid &&!inv.form.sell.$pristine)
				     || !inv.sell
				     || (!setting.negative_sale && inv.sell<0)
				     || (setting.check_sale && inv.sell > inv.total)
				     || inv.invalid_sell}">
		  	<input type="number" step="1"
		  	       class="form-control"
		  	       placeholder="数量"
		  	       required
		  	       disable-key
		  	       x-ng-edit
		  	       x-ng-pattern="pattern.sell"
		  	       x-ng-model="inv.sell"
		  	       x-ng-enter="inv.form.sell.$invalid || auto_save_free(inv)" />
		      </div>
		    </form>
		  </td> 

		  <!-- <td class="vert-align"><span class="fg-red">{{inv.rprice}}<span></td>  -->
		  <!-- <td class="vert-align"><span class="fg-red">{{inv.rdiscount}}</span></td>  -->
		  <td class="vert-align"><span>{{inv.calc}}</span></td>
		  <td  x-ng-if="setting.fixed_mode===1
				&& select.retailer.type_id===1
				&& select.retailer.balance!==0" class="vert-align">
		    <span>{{inv.draw}}</span>
		  </td>
		  <td class="vert-align">
		    <div x-ng-if="!inv.free_color_size">
		      <span x-ng-bind="inv.note" class="bg-blue"></span>
		    </div>
		    <div x-ng-if="inv.free_color_size">-</div>
		  </td>
		  
		  <td class="text-left vert-align"> 
		    <div x-ng-if="inv.$edit">
		      <div class="btn-group" x-ng-if="!inv.free_update"> 
			<button class="btn diablo-input-button yellow"
				x-ng-click="update_inventory(inv)">修改
			  <i class="glyphicon glyphicon-edit"></i></button>
			
			<button class="btn diablo-input-button btn-danger"
				x-ng-click="delete_inventory(inv)">删除
			  <i class="glyphicon glyphicon-erase"></i></button>

			<button x-ng-if="inv.charge && inv.sell > 0"
				class="btn diablo-input-button blue"
				x-ng-click="reject_inventory(inv)">退货
			  <i class="glyphicon glyphicon-circle-arrow-left"></i></button>

			<button x-ng-if="setting.active_score"
				class="btn diablo-input-button purple"
				x-ng-click="cancel_score(inv)">积分
			  <i class="glyphicon glyphicon-trash"></i></button>
			
			<button class="btn diablo-input-button green"
				x-ng-if="(setting.gift_sale && inv.gift) || setting.gift_direct"
				x-ng-click="gift_sale(inv)">赠送
			  <i class="glyphicon glyphicon-gift"></i></button>
		      </div>

		      <div class="btn-group btn-group-solid" x-ng-if="inv.free_update">
			<button class="btn diablo-input-button btn-success"
				x-ng-disabled="inv.form.good.$invalid
					       || inv.form.sell.$invalid
			    		       || inv.form.fprice.$invalid
			    		       || inv.form.fdiscount.$invalid
					       || (!setting.negative_sale && inv.sell<0)
					       || (setting.check_sale && inv.sell > inv.total) " 
				x-ng-click="auto_save_free(inv)">保存
			  <i class="glyphicon glyphicon-plus"></i></button> 
			
			<button class="btn diablo-input-button btn-danger"
				x-ng-click="cancel_free_update(inv)">取消
			  <i class="glyphicon glyphicon-off"></i></button>
		      </div>
		    </div>
		    
		  </td>
		</tr>

		<tr x-ng-if="inventories.length>0" class="text-center">
		  <td x-ng-if="setting.negative_sale"></td>
		  <td></td> 
		  <td></td>
		  <td></td>
		  <td>{{select.abs_pay}}</td>
		  <td colspan="2"></td>
		  <td class="vert-align">{{select.abs_total}}</td> 
		  <td class="vert-align">{{select.should_pay}}</td>
		  <td x-ng-if="setting.fixed_draw
			       && select.retailer.type_id===1
			       && select.retailer.balance!==0" class="vert-align" x-ng-bind=select.can_draw></td>
		  <td></td>
		  <td></td>
		  <!-- <td colspan="2">{{select.score}}</td> -->
		</tr> 
	      </tbody>
	      <tfoot>
	      </tfoot>
	    </table> <!--END supplier table-->
	  </div> <!--END table responsive--> 
	</div> <!--END panel--> 
	<!-- </uib-tab>  -->
	<!-- </uib-tabset> -->

	<div x-ng-if="select.score!==0">
	  <span class="fg-red">积分：</span>
	  <span class="fg-color-darken"><strong>{{select.score}}</strong></span>
	  
	</div>
	
	<div x-ng-repeat="p in show_promotions">
	  <div>{{p.name}}&nbsp&nbsp&nbsp&nbsp
	    
	    <span class="bg-blue">促销：</span> 
	    <span x-ng-if="p.promotion">
	      <span x-ng-switch on="p.promotion.rule_id">
	      	<span x-ng-switch-when=0>
	      	  <span class="fg-red">{{p.promotion.discount}}</span>折
	      	</span>
		
	      	<span x-ng-switch-when=1>
	      	  满<span class="fg-red">{{p.promotion.cmoney}}</span>
	      	  送<span class="fg-red">{{p.promotion.rmoney}}</span>
	      	</span>

		<span x-ng-switch-when=2>
	      	  买<span class="fg-red">{{p.promotion.cmoney}}</span>
	      	  送<span class="fg-red">{{p.promotion.rmoney}}</span>
	      	</span>

		<span x-ng-switch-when=3>
	      	  <span class="fg-red">{{p.promotion.name}}</span>
	      	</span>

		<span x-ng-switch-when=4>
	      	  <span class="fg-red">{{p.promotion.name}}</span>
	      	</span>

		<span x-ng-switch-when=5>
	      	  <span class="fg-red">{{p.promotion.name}}</span>
	      	</span>
		
	      </span>
	    </span>
	    <span x-ng-if="!p.promotion">无</span>

	    &nbsp&nbsp&nbsp&nbsp<span class="bg-blue">积分：</span>
	    <span x-ng-if="p.score">
	      <span class="fg-red">{{p.score.name}}</span>
	    </span>
	    <span x-ng-if="!p.score">无</span> 
	  </div> 
	</div>
	
      </div> <!--END portlet body--> 
      
    </div> <!--END portlet box-->

    <div x-ng-if="setting.pay_scan" class="row">
      <div class="col-md-12">
	<div class="portlet box light-grey diablo-margin-bottom-5" style="margin-top:30px">
	  <div class="portlet-title">
	    <div class="caption"><i class="glyphicon glyphicon-yen fg-red"></i>
	      <span>支付</span>
	    </div>
	    <div class="actions">
	      <div class="btn-group">
		<button type="button" class="btn blue reload"
			x-ng-click="refresh_pay_scan()">刷新<i class="icon icon-spinner fg-white"></i>
		</button>
	      </div>
	    </div>
	  </div>
	  <div class="tools"></div>
	</div>

	<div class="portlet-body">
	  <div class="panel panel-default">
	    <div class="table-responsive">
	      <table class="table table-bordered table-striped table-hover
			    table-condensed table-advanced">
		<thead>
		  <tr>
		    <th class="text-center">序号</th>
		    <th class="text-center">订单号</th>
		    <th class="text-center">类型</th> 
		    <th class="text-center">金额</th> 
		    <th class="text-center">状态</th> 
		    <th class="text-center">日期</th>
		    <th class="text-center">操作</th>
		  </tr>
		</thead>
		<tbody>
		  <tr class="text-center" x-ng-repeat="h in pay_scan_history">
		    <td x-ng-bind="h.order_id"></td>
		    <td x-ng-bind="h.sn"></td>
		    <td>
		      <div x-ng-switch on="h.type">
			<div x-ng-switch-when=0>微信</div>
			<div x-ng-switch-when=1>支付宝</div>
			<div x-ng-switch-default>未知</div>
		      </div> 
		    </td>
		    <td x-ng-bind="h.balance"></td>
		    <td>
		      <div x-ng-switch on="h.state">
			<div x-ng-switch-when=0><span class="fg-green">成功</span></div>
			<div x-ng-switch-when=1><span class="fg-red">失败</span></div>
			<div x-ng-switch-when=2><span class="fg-pink">支付中</span></div>
			<div x-ng-switch-when=3><span class="fg-magenta">转入退款</span></div>
			<div x-ng-switch-when=4><span class="fg-green">退款成功</span></div>
			<div x-ng-switch-when=5><span class="fg-red">退款失败</span></div>
			<div x-ng-switch-when=9><span class="fg-yellow">未知</span></div>
		      </div> 
		    </td>
		    <td x-ng-bind="h.entry_date"></td>
		    <td>
		      <button x-ng-if="h.state===9 || h.state===2 || h.state===3"
			      class="btn diablo-button btn-danger"
		    	      x-ng-click="check_pay_scan(h)">
			核实<i class="glyphicon glyphicon-check"></i>
		      </button>
		    </td>
		  </tr>
		</tbody>
		<tfoot></tfoot>
	      </table>
	      
	    </div>
	  </div>
	</div>
	
      </div>
    </div>
  </div> <!--END col-md-8-->

  <div class="col-md-4">
    <div class="portlet box light-grey diablo-margin-bottom-5">
      <div class="portlet-title">
	<div class="caption"><i class="glyphicon glyphicon-jpy large fg-red"></i>
	  <span>收银</span>
	  <!-- <span>{{select.datetime|date: 'yyyy-MM-dd'}}</span> -->
	  <!-- <span x-ng-bind=select.shop.name></span> -->
	</div>

	<div class="actions">
	  <div class="btn-group">
	    <button x-ng-if="!setting.disableWithDraw
			     && select.retailer.type_id===1
			     && select.retailer.balance!==0"
	    	    class="btn green"
	    	    x-ng-disabled="disable_withdraw()"
	    	    x-ng-click="withdraw()">提现<i class="glyphicon glyphicon-yen"></i>
	    </button>
	    
	    <button x-ng-if="select.retailer.type_id!==2" class="btn red"
	    	    x-ng-click="get_ticket()">取券<i class="glyphicon glyphicon-bookmark"></i>
	    </button>
	    
	    <button x-ng-if="select.retailer.type_id!==2 && setting.gift_ticket_on_sale===0"
		    x-ng-disabled="has_gift_ticket"
		    class="btn blue" 
		    x-ng-click="gift_ticket()">赠券
	      <i class="glyphicon glyphicon-send"></i></button>
	    
	    <button class="btn btn-success"
	    	    x-ng-disabled="disable_save()"
	    	    x-ng-click="save_wsale()">保存 <i class="glyphicon glyphicon-save"></i></button>
	  </div>
	</div>
      </div>

      <div class="portlet-body" navdiv> 
	<div class="row diablo-good-form-group">
	  <div class="col-xs-12 col-md-12">
	    <div class="input-group">
	      <span class="input-group-addon">
	  	<i class="glyphicon glyphicon-map-marker fg-red"></i>
		{{face(setting.shop_mode).new_sale.employee}}
	      </span>
	      <select class="form-control" type="text"
	      	      x-ng-model="select.employee"
	      	      x-ng-change="change_employee()"
	      	      x-ng-options="e as e.name for e in employees|filter:$viewValue"
		      x-ng-enter="disable_save() || save_wsale()">
	      </select> 
	    </div>
	  </div>
	</div>
	
	<div class="row diablo-good-form-group">
	  <div class="col-xs-12 col-md-12">
	    <div class="input-group">
	      <span class="input-group-addon">
		<i class="glyphicon glyphicon-comment fg-red"></i>备注</span>
	      <input class="form-control"
		     type="text"
		     placeholder="备注"
	    	     x-ng-model="select.comment"/>
	    </div>
	  </div>
	</div>

	<div class="row diablo-good-form-group">
	  <div class="col-xs-12 col-md-12">
	    <div class="input-group">
	      <span class="input-group-addon">
		<i class="glyphicon glyphicon-star fg-red"></i>会员</span>
	      <input x-ng-if="right.master || setting.retailer_mode===0" class="form-control" type="text"
		     x-ng-edit
		     name="retailer"
	  	     x-ng-model="select.retailer"
	  	     placeholder="请选择会员"
	  	     typeahead-editable="false"
		     typeahead-wait-ms="300"
		     typeahead-loading="loading_retailer"
		     typeahead-on-select="on_select_retailer($item, $model, $label)"
		     uib-typeahead="s as s.name for s in match_retailer_phone($viewValue)"/>
	      <input x-ng-if="!right.master && setting.retailer_mode===1" class="form-control" type="text"
		     x-ng-edit
		     name="retailer"
	  	     x-ng-model="select.retailer.name"
	  	     placeholder="请选择会员" 
		     x-ng-enter="match_retailer_phone(select.retailer.name)"/>
	      <span class="input-group-btn"> 
		<button class="btn btn-success" x-ng-click="new_retailer()">
		  <i class="glyphicon glyphicon-plus"></i></button>
	      </span>
	      <span x-ng-show="loading_retailer">
	  	<i class="icon-spinner icon-spin icon-2x form-control-feedback"></i>
	      </span> 
	      <span x-ng-if="select.retailer.type_id===1" class="input-group-btn"> 
		<button class="btn btn-danger" x-ng-click="start_charge()">
		  <i class="glyphicon glyphicon-yen"></i></button>
	      </span>
	      <span x-ng-if="select.retailer && select.retailer.type_id!==2" class="input-group-btn"> 
		<!-- <button class="btn btn-warning" x-ng-click="update_retailer()"> -->
		<!--   <i class="glyphicon glyphicon-edit"></i></button> -->
		<button class="btn btn-warning"
			data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> 
		  <span class="sr-only">Toggle Dropdown</span>
		  <i class="glyphicon glyphicon-hand-down"></i>
		</button>
		<ul class="dropdown-menu">
		  <li>
		    <a href="javascript:;" x-ng-click="update_retailer()">
		      <i class="glyphicon glyphicon-edit fg-red"></i>修改</a>
		    <a href="javascript:;" x-ng-click="get_order()">
		      <i class="glyphicon glyphicon-shopping-cart fg-red"></i>定单</a>
		  </li>
		</ul>
	      </span>
	    </div> 
	  </div> 
	</div>

	<div x-ng-if="setting.show_wprice" class="row diablo-good-form-group">
	  <div class="col-xs-12 col-md-12">
	    <div class="input-group">
	      <span class="input-group-addon">
		<i class="glyphicon glyphicon-yen fg-red"></i>整单</span>
	      <form name="select.form.wForm">
		<div ng-class="{'has-error':select.form.wForm.$invalid && !select.form.wForm.$pristine}">
	  	  <input class="form-control"
			 type="number" step="1"
			 disable-key
			 x-ng-edit
	  		 x-ng-model="select.wprice"
			 x-ng-pattern="pattern.money"
			 placeholder="整单价格"/>
		</div>
	      </form>
	    </div>
	  </div>
	</div>
	
	<div class="row diablo-good-form-group">
	  <div class="col-xs-12 col-md-12">
	    <div class="input-group">
	      <span class="input-group-addon">
		<i class="glyphicon glyphicon-yen fg-red"></i>现金</span>
	      <form name="select.form.cashForm">
		<div ng-class="{'has-error':select.form.cashForm.$invalid
			       && !select.form.cashForm.$pristine}">
	  	  <input class="form-control"
			 type="number" step="0.01"
			 disable-key
			 x-ng-edit
			 focus-auto="focus_attr.cash"
			 x-ng-plus="focus_good_or_barcode()"
	  		 x-ng-model="select.cash"
			 x-ng-pattern="pattern.money"
			 placeholder="现金" 
			 x-ng-enter="disable_save() || save_wsale()"/>
		</div>
	      </form>
	    </div>
	  </div>
	</div>
	
	<div class="row diablo-good-form-group">
	  <div class="col-xs-12 col-md-12">
	    <div class="input-group">
	      <span class="input-group-addon">
		<i class="glyphicon glyphicon-yen fg-red"></i>微信</span>
	      <form name="select.form.wForm">
		<div ng-class="{'has-error':select.form.wForm.$invalid && !select.form.wForm.$pristine}">
	  	  <input class="form-control"
			 type="number" step="0.01"
			 disable-key
			 x-ng-edit
			 x-ng-plus="focus_good_or_barcode()"
			 x-ng-pattern="pattern.money"
	  		 x-ng-model="select.wxin"
			 placeholder="微信"
			 x-ng-enter="disable_save() || save_wsale()"/> 
		</div>
	      </form>
	      <span x-ng-if="setting.pay_scan" class="input-group-btn"> 
		<button class="btn bg-magenta fg-white" x-ng-click="pay_scan(0)">
		  <i class="glyphicon glyphicon-qrcode"></i></button>
	      </span>
	    </div>
	  </div>
	</div>

	<div class="row diablo-good-form-group">
	  <div class="col-xs-12 col-md-12">
	    <div class="input-group">
	      <span class="input-group-addon">
		<i class="glyphicon glyphicon-yen fg-red"></i>支付宝</span>
	      <form name="select.form.lForm">
		<div ng-class="{'has-error':select.form.lForm.$invalid && !select.form.lForm.$pristine}">
	  	  <input class="form-control"
			 type="number" step="0.01"
			 disable-key
			 x-ng-edit
			 x-ng-plus="focus_good_or_barcode()"
			 x-ng-pattern="pattern.money"
	  		 x-ng-model="select.aliPay"
			 placeholder="支付宝"
			 x-ng-enter="disable_save() || save_wsale()"/>
		</div>
	      </form>
	      <span x-ng-if="setting.pay_scan" class="input-group-btn"> 
		<button class="btn bg-magenta fg-white" x-ng-click="pay_scan(1)">
		  <i class="glyphicon glyphicon-qrcode"></i></button>
	      </span>
	    </div>
	  </div>
	</div>

	<div class="row diablo-good-form-group">
	  <div class="col-xs-12 col-md-12">
	    <div class="input-group">
	      <span class="input-group-addon">
		<i class="glyphicon glyphicon-credit-card fg-red"></i>刷卡</span>
	      <form name="select.form.c">
		<div ng-class="{'has-error':select.form.c.$invalid && !select.form.c.$pristine}">
	  	  <input class="form-control"
			 type="number" step="0.01"
			 disable-key
			 x-ng-edit
			 x-ng-pattern="pattern.money"
			 x-ng-plus="focus_good_or_barcode()"
	  		 x-ng-model="select.card"
			 placeholder="刷卡"
			 x-ng-enter="disable_save() || save_wsale()"/>
		</div>
	      </form>
	    </div>
	  </div>
	</div>

	<div class="row">
	  <div x-ng-if="setting.vip_discount_mode!==3" class="col-xs-12 col-md-12">
	    <div class="input-group">
	      <span class="input-group-addon">
	    	<i class="glyphicon glyphicon-ban-circle fg-red"></i>核销</span>
	      <select x-ng-if="!setting.show_wprice" class="form-control"
	  	      x-ng-model="select.verificate"
	  	      x-ng-options="v for v in vpays">
	      </select>
	      <input x-ng-if="setting.show_wprice"
		     class="form-control"
		     type="number"
	  	     x-ng-model="select.verificate" readonly />
	    </div>
	  </div>

	  <div x-ng-if="setting.vip_discount_mode===3" class="col-xs-12 col-md-12">
	    <div class="input-group">
	      <span class="input-group-addon">
	    	<i class="glyphicon glyphicon-ban-circle fg-red"></i>核销</span>
	      <input class="form-control"
		     type="number" step="1"
		     x-ng-edit
	  	     x-ng-model="select.verificate"/> 
	    </div>
	    <!-- <div x-ng-show="!check_verificate(select.retailer)"> -->
	    <!--   <span class="fg-red">核销金额超过上限</span> -->
	    <!-- </div> -->
	  </div> 
	</div>

	<div x-ng-if="setting.hide_charge" class="row" style="margin-top:10px">
	  <div class="col-xs-12 col-md-12">
	    <div class="input-group">
	      <span class="input-group-addon">
	    	<i class="glyphicon glyphicon-yen fg-red"></i>找零</span> 
	      <input class="form-control"
		     readonly
	    	     x-ng-model="select.charge"/> 
	    </div>
	  </div>
	</div>

	<div class="row diablo-good-form-group" style="margin-top:10px">
	  <div class="col-xs-12 col-md-12">
	    <div class="input-group">
	      <span class="input-group-addon">
		<i class="glyphicon glyphicon-lock fg-red"></i>验证码</span>
	      <input class="form-control"
		     type="number" step="1"
		     disable-key
		     x-ng-edit
		     name="vcode"
		     x-ng-pattern="pattern.vcode"
	  	     x-ng-model="select.vcode"
	  	     placeholder="验证码2分钟内有效"
		     x-ng-enter="disable_save() || save_wsale()"/> 
	      <span class="input-group-btn"> 
		<button class="btn btn-success" x-ng-click="send_sms_vcode()">
		  <i class="glyphicon glyphicon-arrow-right"></i></button>
	      </span> 
	    </div> 
	  </div> 
	</div>
	
      </div>
      
      <div class="row">
	<div x-ng-if="select.retailer && select.retailer.type_id!==2" class="col-xs-12 col-md-12"> 
	  <h5 class="text-center" style="margin-top:-2px">
    	    <span x-ng-if="select.retailer.lunar_id===0">生日/公历：<span class="fg-blue sell-font">
		<strong>{{select.retailer.birth}}</strong></span>&nbsp&nbsp
    	    </span>
	    <span x-ng-if="select.retailer.lunar_id===1">生日/农历：<span class="fg-blue sell-font">
		<strong>{{select.retailer.birth}}</strong></span>&nbsp&nbsp
    	    </span>
    	    <span>积分：<span class="fg-red sell-font">
		<strong>{{select.retailer.score}}</strong></span>
    	    </span>
	    <span>备注：<span class="fg-red sell-font">
		<strong>{{select.retailer.comment}}</strong></span>
    	    </span>
	  </h5>
	</div>
      </div>

      <div class="row">
	<div x-ng-if="select.retailer && select.retailer.type_id===1" class="col-xs-12 col-md-12"> 
	  <h5 class="text-center" style="margin-top:-2px">
	    <span x-ng-if="select.recharge>0">充值：<span class="fg-blue sell-font">
		<strong>{{select.recharge}}</strong></span>&nbsp&nbsp
	    </span>
	    
    	    <span>余额：<span class="fg-blue sell-font">
		<strong>{{select.surplus}}</strong></span>&nbsp&nbsp
    	    </span>
	    
    	    <span>结余：<span class="fg-red sell-font">
		<strong>{{select.left_balance}}</strong></span>&nbsp&nbsp
    	    </span> 
	  </h5>
	</div>
      </div>

      <div class="row">
	<div class="col-xs-12 col-md-12"> 
	  <h5 class="text-center" style="margin-top:-2px">
	    <span>数量：<span class="fg-red sell-font">
		<strong>{{select.abs_total}}</strong></span></span>&nbsp&nbsp 
	    <span>应付：<span class="fg-blue sell-font">
		<strong>{{select.should_pay}}</strong></span>
	    </span>
	  </h5>
	</div>
      </div>

      <div class="row">
	<div class="col-xs-12 col-md-12">
	  <h5 class="text-center" style="margin-top:-2px">
	    <span>实付：<span class="fg-red sell-font">
		<strong>{{select.has_pay}}</strong></span></span>&nbsp&nbsp
	    <span x-ng-if="!setting.hide_charge" >找零：<span class="fg-red sell-font">
		<strong>{{select.charge}}</strong></span>
	    </span> 
	  </h5>
	</div>
      </div>

      <div class="row">
	<div class="col-xs-12 col-md-12"> 
	  <h5 class="text-center" style="margin-top:-2px">
	    <span x-ng-if="select.ticket_balance">券：
    	      <span class="fg-blue sell-font"><strong>{{select.ticket_balance}}</strong></span>&nbsp&nbsp
	    </span>
	    <span x-ng-if="select.withdraw">提现：
    	      <span class="fg-blue sell-font"><strong>{{select.withdraw}}</strong></span>&nbsp&nbsp
	    </span>
	    <span x-ng-if="select.cash">现金：
    	      <span class="fg-blue sell-font"><strong>{{select.cash}}</strong></span>&nbsp&nbsp
	    </span>
	    <span x-ng-if="select.card">刷卡：
    	      <span class="fg-blue sell-font"><strong>{{select.card}}</strong></span>&nbsp&nbsp
	    </span>
	    <span x-ng-if="select.wxin">微信：
    	      <span class="fg-blue sell-font"><strong>{{select.wxin}}</strong></span>&nbsp&nbsp
	    </span>
	    <span x-ng-if="select.wxin">支付宝：
    	      <span class="fg-blue sell-font"><strong>{{select.aliPay}}</strong></span>&nbsp&nbsp
	    </span>
	  </h5>
	</div>
      </div> 
    </div> 
  </div> <!--end col-md-4 -->
  
</div> <!--END row-->

<!-- <div class="row"> -->
<!--   <div class="col-md-8"> -->
<!--     <div class="portlet box purple diablo-margin-bottom-5"> -->
<!--       <div class="portlet-title"> -->
<!-- 	<div class="caption"><i class="glyphicon glyphicon-yen"></i> -->
<!-- 	  <span>支付</span> -->
<!-- 	</div> -->
<!-- 	<div class="actions"> -->
<!-- 	  <div class="btn-group"> -->
<!-- 	    <button type="button" class="btn yellow-crusta reload" -->
<!-- 		    x-ng-click="pay_refresh()">刷新<i class="icon icon-spinner fg-white"></i> -->
<!-- 	    </button>  -->
<!-- 	  </div> -->
<!-- 	</div> -->
<!-- 	<div class="tools"></div> -->
<!--       </div> -->
<!--     </div> -->
<!--   </div> -->
<!-- </div> -->

<script type="text/ng-template" id="wsale-new.html">
  <div class="modal-body"> 
    <div class="diablo-form-group">
      <div class="input-group">
	
	<span class="input-group-addon">
	  <i class="glyphicon glyphicon-yen fg-red"></i>
	</span>

	<div x-ng-if="!params.right.m_price">
	  <input class="form-control text-center"
		 readonly
		 x-ng-model="params.fprice" />
	</div>
	<div x-ng-if="params.right.m_price">
	  <form name="fprice">
	    <div ng-class="{'has-error':fprice.$invalid && !fprice.$pristine}">
	      <input class="form-control text-center"
		     type="number" step="0.01"
		     required
		     disable-key 
		     x-ng-model="params.fprice"
		     x-ng-edit
		     placeholder="支持两位小数"
		     x-ng-pattern="/^\d+(.\d{1,2})?$/"/>
	    </div>
	  </form>
	</div>
	
	<span class="input-group-addon">
	  <i class="glyphicon glyphicon-sort-by-attributes-alt fg-red"></i>
	</span>
	
	<div x-ng-if="!params.right.m_discount">
	  <input class="form-control text-center"
		 type="number" step="0.01"
		 readonly
		 x-ng-model="params.fdiscount"/>
	</div>
	
	<div x-ng-if="params.right.m_discount">
	  <form name="fdiscount">
	    <div ng-class="{'has-error':fdiscount.$invalid && !fdiscount.$pristine}">
	      <input class="form-control text-center"
		     type="number" step="0.01"
		     required
		     disable-key 
		     x-ng-pattern="/^\d{1,2}(\.\d{1,2})?$|100$/"
		     x-ng-model="params.fdiscount"
		     x-ng-edit
		     placeholder="dd.dd" />
	    </div>
	  </form>
	</div>
      </div>
    </div>

    
    <div class="table-responsive">
      <table class="table table-bordered
		    table-striped table-condensed table-advanced" navtable>
	<tbody>
	  <tr>
	    <td></td>
	    <td x-ng-repeat="s in params.sizes" x-ng-switch on="s">
	      <span x-ng-switch-when="0">均码</span>
	      <span x-ng-switch-default>{{s}}</span>
	    </td>
	  </tr>
	  <tr x-ng-repeat="c in params.colors">
	    <td x-ng-show="params.large_size" x-ng-switch on="c.cid">
	      <span x-ng-switch-when="0">均色</span>
	      <span x-ng-switch-default>{{c.cname}}</span>
	    </td>

	    <td x-ng-show="!params.large_size"
		class="col-md-1"
		x-ng-switch on="c.cid">
	      <span x-ng-switch-when="0">均色</span>
	      <span x-ng-switch-default>{{c.cname}}</span>
	    </td>

	    <td x-ng-repeat="s in params.sizes">
	      <div x-ng-if="(amount=params.get_amount(c.cid, s, params.amounts))?true:false">
		
		<div class="input-group">
		  <span class="input-group-addon modal-input-group-addon">
		    {{amount.count}}
		  </span>
		  <form name="aform">
		    <div ng-class="{'has-error':aform.$invalid || !params.valid_sell(amount)}">
		      <input x-ng-if="amount"
			     class="form-control modal-input text-center"
			     type="number" step="1"
			     disable-key
			     x-ng-enter="!fprice.$invalid && !fdiscount.$invalid && params.valid(params.amounts) && ok()"
			     x-ng-model="amount.sell_count"
			     focus-auto="amount.focus" />
		    </div>
		  </form>
		</div>
		
	      </div> 
	    </td> 
	  </tr>
	</tbody> 
      </table>
    </div> <!--END table-responsive-->
    <image x-ng-show="params.path" class="img-responsive img-thumbnail" ng-src="{{params.path}}"></image>
  </div>

  <div class="modal-footer">
    <button class="btn btn-primary"
	    x-ng-disabled="fprice.$invalid
			   || fdiscount.$invalid
			   || !params.valid(params.amounts)"
	    x-ng-click="ok()">保存
    </button>
    <button class="btn btn-warning" x-ng-click="cancel()">取消</button>
  </div>
</script>

<script type="text/ng-template" id="wsale-detail.html">
  <div class="modal-body">

    <div class="diablo-form-group">
      <div class="input-group">
	
	<span class="input-group-addon">
	  <i class="glyphicon glyphicon-yen fg-red"></i>
	</span> 
	<input class="form-control text-center"
	       readonly
	       x-ng-model="params.fprice" />
	
	<span class="input-group-addon">
	  <i class="glyphicon glyphicon-sort-by-attributes-alt fg-red"></i>
	</span> 
	<input class="form-control text-center"
	       readonly
	       x-ng-model="params.fdiscount" /> 
      </div>
    </div>
    
    <div class="table-responsive">
      <table class="table table-bordered
		    table-striped table-condensed table-advanced">
	<tbody>
	  <tr>
	    <td></td>
	    <td x-ng-repeat="s in params.sizes" x-ng-switch on="s">
	      <span x-ng-switch-when="0">均码</span>
	      <span x-ng-switch-default>{{s}}</span>
	    </td>
	  </tr>
	  <tr x-ng-repeat="c in params.colors">
	    <td class="col-md-1" x-ng-switch on="c.cid">
	      <span x-ng-switch-when="0">均色</span>
	      <span x-ng-switch-default>{{c.cname}}</span>
	    </td>
	    <!-- <td class="col-md-1">{{c.cname}}</td> -->
	    <td x-ng-repeat="s in params.sizes">
	      {{params.get_amount(c.cid, s, params.amounts).sell_count}} 
	    </td>
	  </tr>
	</tbody>
      </table>
    </div> <!--END table-responsive-->
    <image x-ng-show="params.path"
    	   class="img-responsive img-thumbnail"
    	   ng-src="{{params.path}}"></image>
  </div>

  <div class="modal-footer">
    <button class="btn btn-primary" x-ng-click="ok()">确定</button>
    <!-- <button class="btn btn-warning" x-ng-click="cancel()">取消</button> -->
  </div>
</script>

<script type="text/ng-template" id="new-withdraw.html">
  <div class="modal-header">
    <button class="close" x-ng-click="cancel()" type="button">
      <span aria-hidden="true">&times;</span>
      <span class="sr-only"></span>
    </button>
    
    <h4 class="modal-title"><span class="label label-sm label-primary">
	会员提现</span></h4>
  </div>
  
  <div class="modal-body">
    <form class="form-horizontal" name="withdrawForm" novalidate>
      <div class="form-body">
	
	<div class="form-group">
	  <label class="col-sm-3 col-md-3 control-label">姓名</label>
	  <div class="col-sm-6 col-md-6">
	    <input class="form-control"
		   type="text"
		   x-ng-readonly="true"
		   x-ng-model="params.retailer.name"/> 
	  </div>
	</div>

	<div class="form-group">
	  <label class="col-sm-3 col-md-3 control-label">余额</label>
	  <div class="col-sm-6 col-md-6">
	    <input class="form-control"
		   type="number"
		   readonly
		   x-ng-model="params.retailer.surplus"/> 
	  </div>
	</div>

	<div x-ng-if="params.retailer.limitWithdraw!==0" class="form-group">
	  <label class="col-sm-3 col-md-3 control-label">限额提现</label>
	  <div class="col-sm-6 col-md-6">
	    <input class="form-control"
		   type="number"
		   name="limitBalance"
		   x-ng-model="params.retailer.limitWithdraw"/>
	    <div ng-show="!params.check_limit(params.retailer.limitWithdraw)">
	      <span class="fg-red">限额帐户余额不足或提现超过上限</span>
	    </div>
	  </div>
	</div>
	
	<div class="form-group">
	  <label class="col-sm-3 col-md-3 control-label">普通提现</label> 
	  <div class="col-sm-6 col-md-6"> 
	    <input class="form-control"
		   type="number" step="1"
		   required
		   disable-key
		   x-ng-edit
		   name="balance"
		   x-ng-pattern="/^\d+(.\d{1,2})?$/"
		   x-ng-model="params.retailer.unlimitWithdraw"/> 
	    <div ng-show="!params.check_withdraw(params.retailer.unlimitWithdraw, params.retailer.limitWithdraw)">
	      <span class="fg-red">帐户余额不足或提现超过上限</span>
	    </div>
	  </div> 
	</div>

	<div x-ng-if="!params.hide_pwd" class="form-group">
	  <label class="col-sm-3 col-md-3 control-label">密码</label>
	  <div class="col-sm-6 col-md-6">
	    <input class="form-control"
		   required
		   focus-auto="true"
		   type="password"
		   name="withdraw"
		   x-ng-model="params.retailer.password"
		   x-ng-enter="withdrawForm.$valid && params.check_withdraw(params.retailer.unlimitWithdraw) && ok()"/> 
	  </div>
	</div>
	
      </div>
    </form>
  </div>

  <div class="modal-footer">
    <button class="btn btn-primary"
	    x-ng-disabled="withdrawForm.$invalid
			   || !params.check_limit(params.retailer.limitWithdraw)
			   || !params.check_withdraw(params.retailer.unlimitWithdraw, params.retailer.limitWithdraw)"
	    x-ng-click="ok()">确定</button>
    <button class="btn btn-warning" x-ng-click="cancel()">取消</button>
  </div> 
</script>

<script type="text/ng-template" id="manual-withdraw.html">
  <div class="modal-header">
    <button class="close" x-ng-click="cancel()" type="button">
      <span aria-hidden="true">&times;</span>
      <span class="sr-only"></span>
    </button>
    
    <h4 class="modal-title"><span class="label label-sm label-primary">
	会员提现</span></h4>
  </div>
  
  <div class="modal-body">
    <form class="form-horizontal" name="mWithdrawForm" novalidate>
      <div class="form-body">
	
	<div class="form-group">
	  <label class="col-sm-2 col-md-2 control-label">姓名</label>
	  <div class="col-sm-8 col-md-8">
	    <input class="form-control"
		   type="text"
		   x-ng-readonly="true"
		   x-ng-model="params.retailer.name"/> 
	  </div>
	</div>

	<div class="form-group">
	  <label class="col-sm-2 col-md-2 control-label">余额</label>
	  <div class="col-sm-8 col-md-8">
	    <input class="form-control"
		   type="number"
		   readonly
		   x-ng-model="params.retailer.surplus"/> 
	  </div>
	</div>

	<div class="form-group">
	  <label class="col-sm-2 col-md-2 control-label">提现</label>
	  <div class="col-md-8 col-sm-8">
	    <div class="input-group">
	      <input class="form-control"
		     type="number"
		     readonly 
		     name="total_draw"
		     x-ng-model="params.total_draw"/> 
	      <span class="input-group-btn">
		<button x-ng-click="params.add_draw(params.draw_cards, params.cards, params.total_draw)"
			x-ng-disabled="params.draw_cards.length === params.cards.length"
			type="button"
			class="btn green">
		  <i class="glyphicon glyphicon-plus"></i>
		</button>
	      </span>
	      <span class="input-group-btn">
		<button x-ng-click="params.total_draw=params.move_draw(params.draw_cards, params.total_draw)"
			x-ng-disabled="params.draw_cards.length===1"
			type="button"
			class="btn red">
		  <i class="glyphicon glyphicon-minus"></i>
		</button>
	      </span>
	    </div>
	  </div> 
	</div> <!--  -->

	<div class="form-group">
	  <label class="col-sm-2 col-md-2 control-label">充值卡</label>
	  <div class="col-md-8 col-sm-8">
	    <table class="table
			  table-bordered
			  table-striped
			  table-condensed
			  table-advanced
			  diablo-form-table"> 
	      <tbody>
		<tr class="text-center" x-ng-repeat="d in params.draw_cards"> 
		  <td class="vert-align">
		    <form name="lcForm">
		      <div ng-class="{'has-error': mWithdrawForm.$invalid}">
			<div class="input-group">
			  <select class="form-control"
				  required
				  x-ng-model="d.card"
				  x-ng-options="c.name for c in params.cards">
			  </select>
			  <span class="input-group-addon">
			    <span class="fg-red">{{d.card.balance}}</span>
			  </span>
			  <!-- <span class="input-group-addon"></span> -->
			  <input type="number"
				 step="1"
				 class="form-control"
				 required
				 disable-key
				 x-ng-edit
				 x-ng-model="d.draw"
				 x-ng-pattern="/^\d+(.\d{1,2})?$/"
				 x-ng-change="params.total_draw=params.calc_total_draw(params.draw_cards)"/> 
			</div>
			<div ng-show="!params.check_card_withdraw(params.draw_cards, mWithdrawForm)">
			  <span class="fg-red">帐户余额不足或提现超过上限</span>
			</div>
		      </div> 
		    </form> 
		  </td> 
		</tr> 
	      </tbody>
	    </table>
	  </div>
	</div>

	<div x-ng-if="!params.hide_pwd" class="form-group">
	  <label class="col-sm-2 col-md-2 control-label">密码</label>
	  <div class="col-sm-8 col-md-8">
	    <input class="form-control"
		   required
		   focus-auto="true"
		   type="password"
		   name="withdraw"
		   x-ng-model="params.retailer.pasosword"
		   x-ng-enter="mWithdrawForm.$valid && params.total_draw<=params.retailer.surplus && ok()"/> 
	  </div>
	</div>
	
      </div>
    </form>
  </div>

  <div class="modal-footer">
    <button class="btn btn-primary"
	    x-ng-disabled="mWithdrawForm.$invalid || params.total_draw>params.retailer.surplus"
	    x-ng-click="ok()">确定</button>
    <button class="btn btn-warning" x-ng-click="cancel()">取消</button>
    <div>{{lcForm}}</div>
  </div> 
</script>

<script type="text/ng-template" id="wsale-draft.html">
  <div class="modal-body">
    <div class="table-responsive">
      <table class="table table-bordered
		    table-striped table-condensed table-advanced">
	<thead>
	  <tr>
	    <th></th>
	    <th>单号</th>
	    <th>会员</th>
	    <!-- <th>店员</th> -->
	    <th>店铺</th>
	  </tr>
	</thead>
	<tbody>
	  <tr x-ng-repeat="d in params.drafts">
	    <td class="vert-align">
	      <div class="checkbox checkbox-danger checkbox-circle">
		<input id={{d.sn}}
		       type="checkbox"
		       x-ng-model="d.select"
		       x-ng-change="params.select(params.drafts, d)"/>
		<label for={{d.sn}}></label>
	      </div>
	    </td>
	    <td>{{d.sn}}</td>
	    <td>{{d.retailer.name}}</td>
	    <!-- <td>{{d.employee.name}}</td> -->
	    <td>{{d.shop.name}}</td>
	    <!-- <td>{{d.datetime}}</td>  -->
	  </tr>
	</tbody>
      </table>
    </div>
  </div>

  <div class="modal-footer">
    <button class="btn btn-primary"
	    x-ng-disabled="!params.valid(params.drafts)"
	    x-ng-click="ok()">确定</button>
    <button class="btn btn-warning" x-ng-click="cancel()">取消</button>
  </div>
</script>

<script type="text/ng-template" id="new-ticket.html">
  <div class="modal-header">
    <button class="close" x-ng-click="cancel()" type="button">
      <span aria-hidden="true">&times;</span>
      <span class="sr-only"></span>
    </button>
    
    <h4 class="modal-title"><span class="label label-sm label-primary">电子卷信息</span></h4>
  </div>
  
  <div class="modal-body">
    <table x-ng-if="params.stickets.length!==0"
	   class="table table-bordered table-striped table-condensed table-advanced">
      <thead>
	<th class="col-md-2"></th>
	<th class="success col-md-3 text-center">批次</th>
	<th class="success col-md-4 text-center">类型</th>
	<th class="success col-md-3 text-center">金额</th>
      </thead>

      <tbody>
	<tr class="text-center" x-ng-repeat="s in params.stickets">
	  <td class="vert-align">
	    <div class="checkbox checkbox-danger checkbox-circle">
	      <input id={{s.batch}}-{{s.id}}
		     type="checkbox"
		     x-ng-model="s.select"
		     x-ng-click="params.check_select_sticket(s, params.stickets, params.ptickets)"/>
	      <label for={{s.batch}}-{{s.id}}></label>
	    </div>
	  </td>
	  <td class="vert-align">{{s.batch}}</td>
	  <td class="vert-align">积分卷</td>
	  <td class="vert-align">{{s.balance}}</td>
	</tr>
      </tbody>
    </table>

    <table x-ng-if="params.ptickets.length!==0"
	   class="table table-bordered table-striped table-condensed table-advanced">
      <thead>
	<th class="col-md-2"></th>
	<th class="danger text-center">名称</th>
	<th class="danger text-center">批次</th>
	<th class="danger text-center">类型</th>
	<th class="danger col-md-2 text-center">金额</th>
      </thead>

      <tbody>
	<tr class="text-center" x-ng-repeat="p in params.ptickets">
	  <td class="vert-align">
	    <div class="checkbox checkbox-danger checkbox-circle">
	      <input id={{p.batch}}-{{p.id}}
		     type="checkbox"
		     x-ng-model="p.select"
		     x-ng-click="params.check_select_pticket(p, params.stickets, params.ptickets)"/>
	      <label for={{p.batch}}-{{p.id}}></label>
	    </div>
	  </td>
	  <td class="vert-align">{{p.name}}</td>
	  <td class="vert-align">{{p.batch}}</td>
	  <td class="vert-align">优惠卷</td>
	  <td class="vert-align">{{p.balance}}</td>
	</tr>
      </tbody>
    </table>
    
    <form class="form-horizontal" name="tForm" novalidate>
      <div class="form-body">
    	<div class="form-group">
    	  <label class="col-sm-2 col-md-2 control-label">批次号</label>
    	  <div class="col-sm-8 col-md-8">
    	    <input class="form-control"
    		   name="ticket"
    		   type="number"
    		   placeholder="请输入电子卷批次号"
    		   x-ng-edit
    		   disable-key
    		   disable-wheel
    		   required
    		   x-ng-model="params.self_batch"
    		   x-ng-enter="tForm.$valid && ok()"/>
    	  </div>
    	</div> 
      </div>
    </form>
    
  </div>

  <div class="modal-footer">
    <button class="btn btn-primary"
	    x-ng-disabled="!params.check_valid(params.self_batch, params.stickets, params.ptickets)"
	    x-ng-click="ok()">确定</button>
    <button class="btn btn-warning" x-ng-click="cancel()">取消</button>
  </div>
</script>

<script type="text/ng-template" id="new-retailer.html">
  <div class="modal-header">
    <button class="close" x-ng-click="cancel()" type="button">
      <span aria-hidden="true">&times;</span>
      <span class="sr-only"></span>
    </button> 
    <h4 class="modal-title"><span class="label label-sm label-primary">新增会员</span></h4>
  </div>
  
  <div class="modal-body">
    <form class="form-horizontal" name="tForm" novalidate>
      <div class="form-body">
	<div x-ng-if="params.retailer.$new" class="form-group">
	  <label class="col-sm-3 col-md-3 control-label">介绍人</label>
	  <div class="col-sm-6 col-md-6"> 
	    <input type="text"
		   class="form-control"
		   name="intro"
		   x-ng-edit
		   placeholder="介绍人电话/姓名/拼音"
		   typeahead-editable="false"
		   typeahead-wait-ms="300"
		   typeahead-loading="iloading"
		   uib-typeahead="s as s.name for s in match_retailer_phone($viewValue)"
		   x-ng-model="params.retailer.intro" />
	    <span x-ng-show="iloading">
	      <i class="icon-spinner icon-spin icon-2x form-control-feedback"></i>
	    </span>
	    <div ng-show="tForm.intro.$invalid && !tForm.intro.$pristine">
	      <span class="fg-red">介绍人只能从下拉列表中获取</span>
	    </div> 
	  </div> 
	</div>
	
	<div class="form-group"> 
	  <label class="col-sm-3 col-md-3 control-label">名称</label>
	  <div class="col-sm-6 col-md-6">
	    <div class="input-group">
	      <div x-ng-class="{'has-error': tForm.name.$invalid && !tForm.name.$pristine}">
		<input type="text"
		       class="form-control"
		       name="name"
		       required
		       placeholder="请输入会员名称"
		       x-ng-model="params.retailer.name"
		       x-ng-pattern="params.pattern.name"/>
	      </div>
	      <span class="input-group-addon bg-white fg-red">*</span>
	    </div>
	    <div ng-show="tForm.name.$invalid && !tForm.name.$pristine">
	      <span class="fg-red">中文，字母，数字，不超过6个字符</span>
	    </div> 
	  </div>
	</div>

	<div class="form-group">
	  <label class="col-sm-3 col-md-3 control-label">联系方式</label>
	  <div class="col-sm-6 col-md-6"> 
	    <div class="input-group">
	      <div x-ng-class="{'has-error': tForm.mobile.$invalid && !tForm.mobile.$pristine}">
		<input class="form-control" type="tel"
		       name="mobile"
		       required
		       x-ng-readonly="!params.retailer.$new"
		       x-ng-pattern="params.pattern.tel_mobile"
		       placeholder="请输入电话或手机号码"
		       class="form-control"
		       x-ng-model="params.retailer.mobile"/>
	      </div>
	      <span class="input-group-addon bg-white fg-red">*</span>
	    </div>
	    <div ng-show="tForm.mobile.$invalid && !tForm.mobile.$pristine">
	      <span class="fg-red">请输入正确的电话或手机号码</span>
	    </div>
	  </div> 
	</div>

	<div class="form-group">
	  <label class="col-sm-3 col-md-3 control-label">生日</label>
	  <div class="col-sm-6 col-md-6">
	    <time-search time="params.retailer.birth"></time-search>
	  </div> 
	</div>

	<div class="form-group">
	  <label class="col-sm-3 col-md-3 control-label">日历</label>
	  <div class="col-sm-6 col-md-6">
	    <select class="form-control" type="text"
	  	    x-ng-model="params.retailer.lunar" 
	  	    x-ng-options="l as l.name for l in params.lunars">
	    </select>
	  </div> 
	</div>

	<div x-ng-if="params.retailer.$new" x-ng-if="retailer.type.id!==2" class="form-group">
	  <label class="col-sm-3 col-md-3 control-label">会员等级</label>
	  <div class="col-sm-6 col-md-6">
	    <select class="form-control" type="text"
	    	    x-ng-model="params.retailer.level"
	    	    x-ng-options="l as l.name for l in params.levels">
	    </select>
	  </div>
	</div>

	<div x-ng-if="params.retailer.$new || params.retailer.type_id===0" class="form-group">
	  <label class="col-sm-3 col-md-3 control-label">会员类型</label>
	  <div class="col-sm-6 col-md-6">
	    <select class="form-control" type="text"
	    	    x-ng-model="params.retailer.type"
	    	    x-ng-options="t as t.name for t in params.retailer_types"
		    x-ng-change="params.password=undefined">
	    </select>
	  </div>
	</div>
	
	<div x-ng-if="params.retailer.$new && !setting.hide_pwd && params.retailer.type.id===1" class="form-group">
	  <label class="col-sm-3 col-md-3 control-label">取现密码</label>
	  <div class="col-sm-6 col-md-6">
	    <div class="input-group">
	      <div x-ng-class="{'has-error': tForm.pass.$invalid && !tForm.pass.$pristine}">
		<input type="password"
		       class="form-control"
		       name="pass"
		       required
		       placeholder="请输入取现密码，默认为空"
		       x-ng-model="params.retailer.password"
		       x-ng-pattern="params.pattern.password"/>
	      </div>
	      <span class="input-group-addon bg-white fg-red">*</span>
	    </div>
	    <div ng-show="tForm.pass.$invalid && !tForm.pass.$pristine">
	      <span class="fg-red">请输入6位数字串</span>
	    </div> 
	  </div>
	</div>

	<div x-ng-if="!params.retailer.$new && !setting.hide_pwd && params.retailer.type_id===0 && params.retailer.type.id===1" class="form-group">
	  <div x-ng-if="!setting.hide_pwd && params.retailer.type.id===1">
	    <label class="col-sm-3 col-md-3 control-label">取现密码</label>
	    <div class="col-sm-6 col-md-6">
	      <div class="input-group">
		<div x-ng-class="{'has-error': tForm.pass.$invalid && !tForm.pass.$pristine}">
		  <input type="password"
			 class="form-control"
			 name="pass"
			 required
			 placeholder="请输入取现密码，默认为空"
			 x-ng-model="params.retailer.password"
			 x-ng-pattern="params.pattern.password"/>
		</div>
		<span class="input-group-addon bg-white fg-red">*</span>
	      </div>
	      <div ng-show="tForm.pass.$invalid && !tForm.pass.$pristine">
		<span class="fg-red">请输入6位数字串</span>
	      </div> 
	    </div>
	  </div>
	</div>

	<!-- <div class="form-group"> -->
	<!--   <label class="col-sm-3 col-md-3 control-label">备注</label> -->
	<!--   <div class="col-sm-6 col-md-6"> -->
	<!--     <input type="text" -->
	<!-- 	   class="form-control" -->
	<!-- 	   name="comment" -->
	<!-- 	   placeholder="请输入备注" -->
	<!-- 	   x-ng-model="params.retailer.comment" -->
	<!-- 	   x-ng-pattern="params.pattern.comment"/>  -->
	<!--   </div> -->
	<!--   <div ng-show="tForm.comment.$invalid && !tForm.comment.$pristine"> -->
	<!--     <span class="fg-red">中文，字母，数字，不支持特殊字符</span>  -->
	<!--   </div>  -->
	<!-- </div> -->
	
      </div>
    </form>
  </div>

  <div class="modal-footer">
    <button class="btn btn-primary" x-ng-disabled="tForm.$invalid" x-ng-click="ok()">确定</button>
    <button class="btn btn-warning" x-ng-click="cancel()">取消</button>
  </div>
</script>

<script type="text/ng-template" id="wretailer-charge.html">
  <div class="modal-header">
    <button class="close" x-ng-click="cancel()" type="button">
      <span aria-hidden="true">&times;</span>
      <span class="sr-only"></span>
    </button>
    
    <h4 class="modal-title">
      <span class="label label-sm label-primary">会员充值</span>
    </h4>
  </div>

  <div class="modal-body">
    <form class="form-horizontal" name="cForm" novalidate> 
      <div class="form-body"> 
	<div class="form-group">
	  <span class="col-md-3 col-sm-3 col-xs-3 control-label">经手人</span>
	  <div class="col-md-6 col-sm-6 col-xs-6">
	    <select class="form-control" type="text"
		    required
	      	    x-ng-model="params.employee"
	      	    x-ng-options="e as e.name for e in employees|filter:$viewValue">
	    </select> 
	  </div>
	</div>

	<div class="form-group">
	  <span class="col-md-3 col-sm-3 col-xs-3 control-label">会员名称</span>
	  <div class="col-md-6 col-sm-6 col-xs-6">
	    <input class="form-control" type="text"
		   required
		   readonly
	  	   x-ng-model="select.retailer.name" /> 
	  </div>
	</div>
	
	<div class="form-group">
	  <span class="col-md-3 col-sm-3 col-xs-3 control-label">会员余额</span>
	  <div class="col-md-6 col-sm-6 col-xs-6">
	    <input class="form-control" type="text"
		   required
		   readonly
	  	   x-ng-model="select.surplus" /> 
	  </div>
	</div>
	
	<div class="form-group">
	  <span class="col-md-3 col-sm-3 col-xs-3 control-label">充值方案</span>
	  <div class="col-md-6 col-sm-6 col-xs-6">
	    <select type="text"
		    class="form-control"
		    x-ng-model="params.select_charge"
		    x-ng-options="c as c.name for c in params.charges"
		    x-ng-change="params.charge_balance=params.calc_charge_balance(params.select_charge)">
	    </select>
	  </div>
	</div>
	
	<div class="form-group">
	  <span class="col-md-3 col-sm-3 col-xs-3 control-label">
	    充值金额（现金）
	  </span>
	  <div class="col-md-6 col-sm-6 col-xs-6">
	    <div class="input-group">
	      <input type="number" step="1"
		     class="form-control"
		     required
		     diable-key
		     disable-wheel
		     ng-edit
		     name="charge"
		     placeholder="请输入充值金额"
		     x-ng-model="params.cash"
		     x-ng-pattern="params.pattern.number"/>
	      <span class="input-group-addon bg-white fg-red">*</span>
	    </div> 
	    <div ng-show="cForm.charge.$invalid && !cForm.charge.$pristine"> 
	      <span class="fg-red">金额只能是整数</span>
	    </div>
	  </div> 
	</div>

	<div class="form-group">
	  <span class="col-md-3 col-sm-3 col-xs-3 control-label">
	    充值金额（刷卡）
	  </span>
	  <div class="col-md-6 col-sm-6 col-xs-6">
	    <div class="input-group">
	      <input type="number" step="1"
		     class="form-control"
		     required
		     diable-key
		     disable-wheel
		     ng-edit
		     name="card"
		     placeholder="请输入刷卡金额"
		     x-ng-model="params.card"
		     x-ng-pattern="params.pattern.number"/>
	      <span class="input-group-addon bg-white fg-red">*</span>
	    </div>
	    <div ng-show="cForm.card.$invalid && !cForm.card.$pristine"> 
	      <span class="fg-red">金额只能是整数</span>
	    </div>
	  </div> 
	</div>

	<div class="form-group">
	  <span class="col-md-3 col-sm-3 col-xs-3 control-label">
	    充值金额（微信）
	  </span>
	  <div class="col-md-6 col-sm-6 col-xs-6">
	    <div class="input-group">
	      <input type="number" step="1"
		     class="form-control"
		     required
		     diable-key
		     disable-wheel
		     ng-edit
		     name="wxin"
		     placeholder="请输入刷卡金额"
		     x-ng-model="params.wxin"
		     x-ng-pattern="params.pattern.number"/>
	      <span class="input-group-addon bg-white fg-red">*</span>
	    </div>
	    <div ng-show="cForm.wxin.$invalid && !cForm.wxin.$pristine"> 
	      <span class="fg-red">金额只能是整数</span>
	    </div>
	  </div> 
	</div>

	<div x-ng-if="params.select_charge.rule_id===0" class="form-group">
	  <span class="col-md-3 col-sm-3 col-xs-3 control-label">赠送金额</span>
	  <div class="col-md-6 col-sm-6 col-xs-6">
	    <input type="text"
		   class="form-control fg-red"
		   x-ng-edit
		   x-ng-model="params.sbalance"> 
	  </div> 
	</div>
	
	<div class="form-group">
	  <label class="col-sm-3 col-md-3 control-label">备注</label>
	  <div class="col-sm-6 col-md-6">
	    <input type="text"
		   class="form-control"
		   name="comment"
		   placeholder="请输入备注"
		   x-ng-model="params.comment"
		   x-ng-pattern="params.pattern.comment"/> 
	  </div>
	  <div ng-show="cForm.comment.$invalid && !cForm.comment.$pristine">
	    <span class="fg-red">中文，字母，数字，不支持特殊字符</span> 
	  </div> 
	</div>
	
      </div>
    </form>
    <h4 x-ng-if="params.$tcharge" class="diablo-margin-top-minus-10 text-center">
      <div>
	<span>应充值金额：</span>
	<span class="fg-red"><strong>{{params.charge_balance}}</strong>
	</span>
      </div>
      <div>
	<span>已充值金额：</span>
	<span class="fg-red"><strong>{{params.cash+params.card+params.wxin}}</strong>
	</span>
      </div>
    </h4>
  </div>

  <div class="modal-footer"> 
    <button class="btn btn-primary"
	    x-ng-disabled="cForm.$invalid||!params.check_charge(params.cash, params.card, params.wxin, params.sbalance)"
	    x-ng-click="ok()">确认</button>
    <button class="btn btn-warning" x-ng-click="cancel()">取消</button>
  </div>  
</script>

<script type="text/ng-template" id="gift-ticket.html"> 
  <div class="modal-body">
    <div class="table-responsive">
      <div class="btn-group table-panel pull-right">
	<button x-ng-disabled="params.tickets.length===0"
		x-ng-click="params.delete_ticket(params.tickets)"
		type="button"
		class="btn red">
	  <i class="glyphicon glyphicon-minus"></i></button> 
	<button x-ng-click="params.add_ticket(params.tickets, params.planes)"
		type="button"
		x-ng-disabled="params.planes.length===1 || params.tickets.length===params.maxSend"
		class="btn green">
	  <i class="glyphicon glyphicon-plus"></i>
	</button>
      </div>
      
      <table class="table table-bordered table-striped table-condensed table-advanced">
	<thead>
	  <th>电子券金额</th>
	  <th>电子券数量</th>
	</thead>
	
	<tbody>
	  <tr class="text-center" x-ng-repeat="c in params.tickets">
	    <td class="vert-align">
	      <form name="cForm">
		<div ng-class="{'has-error':cForm.$invalid && !cForm.$pristine}">
		  <select class="form-control"
			  required
			  x-ng-model="c.plan"
			  x-ng-options="p.name for p in params.planes">
		  </select>
		</div>
	      </form> 
	    </td>

	    <td class="vert-align">
	      <form name="pForm">
		<div ng-class="{'has-error':pForm.$invalid && !pForm.$pristine}">
		  <input type="number"
			 class="form-control"
			 required
			 x-ng-edit
			 x-ng-model="c.count"/>
		</div>
	      </form>
	    </td>
	    
	  </tr>
	</tbody>
      </table>
    </div>
  </div>

  <div class="modal-footer">
    <button class="btn btn-primary"
	    x-ng-disabled="!params.check_ticket(params.tickets)" x-ng-click="ok()">确认</button>
    <button class="btn btn-warning" x-ng-click="cancel()">取消</button>
  </div>  
</script>

<script type="text/ng-template" id="pay-scan.html"> 
  <div class="modal-body"> 
    <form class="form-horizontal" name="pForm" novalidate>
      <div class="form-body">
    	<div class="form-group">
    	  <div class="col-sm-12 col-md-12">
	    <div class="input-group">
	      <span class="input-group-addon">
		<i class="glyphicon glyphicon-yen fg-red"></i>
	      </span>
	      <input class="form-control"
    		     name="balance"
    		     type="number"
    		     placeholder="金额"
    		     x-ng-edit
    		     disable-key
    		     disable-wheel
    		     required
    		     x-ng-model="params.balance" />
	      <span class="input-group-addon"><i class="glyphicon glyphicon-barcode fg-red"></i></span>
	      <from>
    		<input class="form-control"
    		       name="pay_code"
    		       type="password"
    		       placeholder="请扫付款码"
    		       x-ng-edit
    		       disable-key
    		       disable-wheel
    		       required
		       focus-auto="true"
    		       x-ng-model="params.pay_code"
    		       x-ng-enter="pForm.$valid && ok()"/>
	      </from>
	      <span class="input-group-btn">
		<button class="btn btn-warning" x-ng-click="cancel()">取消</button>
	      </span>
	    </div>
    	  </div> 
    	</div> 
      </div>
    </form>
    
  </div> 
</script>

<script type="text/ng-template" id="wsale-retailer-order.html">
  <div class="modal-body">
    <div class="table-responsive">
      <table class="table table-bordered
		    table-striped table-condensed table-advanced">
	<thead>
	  <tr>
	    <th></th>
	    <th>单号</th>
	    <th>营业员</th>
	    <th>会员</th>
	    <th>联系方式</th>
	    <th>数量</th>
	    <th>状态</th>
	    <th>日期</th> 
	  </tr>
	</thead>
	<tbody>
	  <tr x-ng-repeat="o in params.orders">
	    <td class="vert-align">
	      <div class="checkbox checkbox-danger checkbox-circle">
		<input id={{o.rsn}}
		       type="checkbox"
		       x-ng-model="o.select"
		       x-ng-change="params.select(params.orders, o)"/>
		<label for={{o.rsn}}></label>
	      </div>
	    </td>
	    <td>{{o.crsn}}</td>
	    <td>{{o.employee.name}}</td>
	    <td>{{o.retailer}}</td>
	    <td>{{o.mobile}}</td>
	    <td>{{o.total}}</td>
	    <td>{{params.order_state[o.state]}}</td>
	    <td>{{o.entry_date}}</td>
	  </tr>
	</tbody>
      </table>
    </div>
  </div>

  <div class="modal-footer">
    <button class="btn btn-primary"
	    x-ng-disabled="!params.valid(params.orders)"
	    x-ng-click="ok()">确定</button>
    <button class="btn btn-warning" x-ng-click="cancel()">取消</button>
  </div>
</script>
